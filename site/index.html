<!DOCTYPE html>
<html lang="tr">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-7LCE4Z60ZB"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-7LCE4Z60ZB');
  </script>
  
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>simscent — Ana Sayfa</title>
  <meta name="description" content="Benzersiz tercihlerinle eşleşen parfümleri keşfet. Hazır koleksiyonumuzu incele ve sana en uygun eşleşmeyi bul."/>
  <meta name="google-adsense-account" content="ca-pub-9033780165680589">
  <link rel="canonical" href="https://www.simscent.com/"/>
  
  <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
  <link rel="alternate icon" href="/assets/favicon-32.png" sizes="32x32" type="image/png">
  
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,500..700,0..1,-50..200"/>
  
  <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <style>
    /* CSS Variables */
    :root {
      --font-size: 16px;
      --background: #ffffff;
      --foreground: oklch(0.145 0 0);
      --card: #ffffff;
      --card-foreground: oklch(0.145 0 0);
      --primary: #030213;
      --primary-foreground: oklch(1 0 0);
      --secondary: oklch(0.95 0.0058 264.53);
      --secondary-foreground: #030213;
      --muted: #ececf0;
      --muted-foreground: #717182;
      --accent: #e9ebef;
      --accent-foreground: #030213;
      --border: rgba(0, 0, 0, 0.1);
      --destructive: #d4183d;
      --destructive-foreground: #ffffff;
      --ring: oklch(0.708 0 0);
      --radius: 0.625rem;
      
      /* Brand colors */
      --brand-primary: #d97706;
      --brand-secondary: #b45309;
      --amber-50: #fffbeb;
      --amber-100: #fef3c7;
      --amber-600: #d97706;
      --amber-700: #b45309;
    }

    /* Base styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
      font-size: var(--font-size);
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Ubuntu, 'Helvetica Neue', Arial, sans-serif;
      color: var(--foreground);
      line-height: 1.6;
      background: var(--background);
      min-height: 100vh;
    }

    /* Dot pattern background */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: radial-gradient(hsla(0,0%,82%,.2) 1px, transparent 1px);
      background-size: 20px 20px;
      opacity: 0.35;
      pointer-events: none;
      z-index: -1;
    }

    /* Typography */
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      line-height: 1.2;
    }

    h1 { font-size: clamp(2.5rem, 5.6vw, 4rem); }
    h2 { font-size: 2rem; }
    h3 { font-size: 1.5rem; }
    h4 { font-size: 1.25rem; }

    /* Utility classes */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .container {
      max-width: 72rem;
      margin: 0 auto;
      padding: 1rem;
    }

    @media (min-width: 1024px) {
      .container {
        padding: 2rem;
      }
    }

    /* Card component */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 1.5rem;
      box-shadow: 0 8px 30px rgba(0,0,0,.07);
      overflow: hidden;
      margin-top: 1.75rem;
    }

    .card-content {
      padding: 1.5rem;
    }

    @media (min-width: 1024px) {
      .card-content {
        padding: 2.5rem;
      }
    }

    /* Button component */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
      transition: all 0.2s;
      cursor: pointer;
      border: none;
      font-family: inherit;
      text-decoration: none;
    }

    .btn-primary {
      background: var(--primary);
      color: var(--primary-foreground);
      padding: 0.75rem 1.5rem;
    }

    .btn-primary:hover {
      background: #000;
    }

    .btn-secondary {
      background: var(--secondary);
      color: var(--secondary-foreground);
      padding: 0.75rem 1.5rem;
    }

    .btn-outline {
      background: transparent;
      color: var(--foreground);
      border: 1px solid var(--border);
      padding: 0.75rem 1.5rem;
    }

    .btn-outline:hover {
      background: var(--accent);
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }

    .btn-lg {
      padding: 1rem 2rem;
      font-size: 1.125rem;
    }

    .btn-icon {
      width: 2.75rem;
      height: 2.75rem;
      border-radius: 50%;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Badge component */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.375rem 0.875rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 700;
      background: var(--secondary);
      color: var(--secondary-foreground);
    }

    .badge-outline {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--foreground);
    }

    /* Input component */
    .input {
      width: 100%;
      border: none;
      background: transparent;
      outline: none;
      font-size: 1rem;
      color: var(--foreground);
      padding: 0.75rem;
    }

    .input::placeholder {
      color: var(--muted-foreground);
    }

    /* Search bar */
    .search-container {
      position: relative;
      width: 100%;
      max-width: 48rem;
      margin: 0 auto;
    }

    .search-bar {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--background);
      border: 1px solid var(--border);
      border-radius: 9999px;
      padding: 0.75rem 1rem;
      box-shadow: 0 4px 15px rgba(0,0,0,.05);
    }

    .suggestions {
      position: absolute;
      left: 0;
      right: 0;
      top: 100%;
      margin-top: 0.75rem;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 1rem;
      box-shadow: 0 8px 30px rgba(0,0,0,.07);
      max-height: 20rem;
      overflow-y: auto;
      z-index: 50;
      display: none;
    }

    .suggestion-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .suggestion-item:hover {
      background: var(--muted);
    }

    .suggestion-thumb {
      width: 2.25rem;
      height: 2.25rem;
      border-radius: 0.5rem;
      object-fit: cover;
      flex-shrink: 0;
    }

    .suggestion-name {
      font-weight: 600;
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .suggestion-brand {
      color: var(--muted-foreground);
      font-size: 0.75rem;
    }

    /* Header */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.25rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
    }

    .brand:hover .brand-text {
      color: var(--brand-primary);
    }

    .brand-logo {
      width: 2rem;
      height: 2rem;
      background: var(--brand-primary);
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 0.875rem;
    }

    .brand-text {
      font-size: 1.5rem;
      font-weight: 700;
      font-family: 'Playfair Display', serif;
      transition: color 0.2s;
    }

    /* Hero section */
    .hero {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2.5rem;
      align-items: center;
      margin-top: 1.25rem;
    }

    @media (min-width: 1024px) {
      .hero {
        grid-template-columns: 1fr 1fr;
        gap: 4rem;
      }
    }

    .hero-image-container {
      position: relative;
      order: 2;
    }

    @media (min-width: 1024px) {
      .hero-image-container {
        order: 1;
      }
    }

    .hero-blob-1 {
      position: absolute;
      left: -1rem;
      top: -1rem;
      width: 7.5rem;
      height: 7.5rem;
      background: var(--amber-100);
      border-radius: 1.5rem;
      opacity: 0.8;
    }

    .hero-blob-2 {
      position: absolute;
      right: -0.5rem;
      bottom: -0.5rem;
      width: 8rem;
      height: 8rem;
      background: var(--amber-50);
      border-radius: 1.5rem;
      opacity: 0.6;
    }

    .hero-image {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1;
      object-fit: cover;
      padding: 1rem;
      background: white;
      border: 1px solid var(--border);
      border-radius: 1.5rem;
      transform: rotate(-6deg);
      box-shadow: 0 28px 70px rgba(0,0,0,.15);
    }

    .hero-content {
      order: 1;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    @media (min-width: 1024px) {
      .hero-content {
        order: 2;
      }
    }

    .hero-title {
      margin-bottom: 1rem;
    }

    .hero-description {
      font-size: 1.125rem;
      color: var(--muted-foreground);
      max-width: 48rem;
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    /* Perfume cards */
    .perfume-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));
      gap: 1rem;
    }

    .perfume-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 1rem;
      overflow: hidden;
      transition: all 0.3s;
      cursor: pointer;
      padding: 1rem;
    }

    .perfume-card:hover {
      transform: translateY(-0.25rem);
      box-shadow: 0 12px 40px rgba(0,0,0,.1);
      border-color: rgba(217, 119, 6, 0.35);
    }

    .perfume-image {
      width: 100%;
      aspect-ratio: 1 / 1;
      object-fit: cover;
      border-radius: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .perfume-brand {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--brand-primary);
      margin-bottom: 0.25rem;
      cursor: pointer;
    }

    .perfume-brand:hover {
      color: var(--brand-secondary);
      text-decoration: underline;
    }

    .perfume-name {
      font-weight: 600;
      line-height: 1.3;
      margin-bottom: 0.5rem;
    }

    .perfume-similarity {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Score rings */
    .score-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-top: 1.5rem;
    }

    @media (min-width: 480px) {
      .score-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    .score-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .score-ring {
      position: relative;
      width: 3.5rem;
      height: 3.5rem;
      margin-bottom: 0.5rem;
    }

    .score-svg {
      width: 3.5rem;
      height: 3.5rem;
      transform: rotate(-90deg);
    }

    .score-bg {
      fill: none;
      stroke: var(--muted);
      stroke-width: 6;
    }

    .score-fg {
      fill: none;
      stroke: var(--brand-primary);
      stroke-width: 6;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.6s;
    }

    .score-value {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 0.875rem;
    }

    .score-label {
      font-size: 0.75rem;
      text-align: center;
      color: var(--muted-foreground);
    }

    /* Preferences */
    .preferences-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(14rem, 1fr));
      gap: 0.75rem;
    }

    .preference-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      padding: 0.75rem;
      background: var(--background);
      border: 1px solid var(--border);
      border-radius: 0.875rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .preference-item:hover {
      background: var(--muted);
    }

    .preference-label-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .preference-label {
      font-weight: 600;
      font-size: 0.875rem;
    }

    @media (min-width: 768px) {
      .preference-label {
        font-size: 1rem;
      }
    }

    .help-icon {
      width: 1.25rem;
      height: 1.25rem;
      border-radius: 50%;
      background: var(--muted);
      color: var(--muted-foreground);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.75rem;
      cursor: help;
      position: relative;
    }

    .help-icon:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-bottom: 0.5rem;
      background: var(--primary);
      color: var(--primary-foreground);
      padding: 0.5rem 0.75rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 500;
      line-height: 1.5;
      white-space: nowrap;
      z-index: 100;
      max-width: 15rem;
      text-align: center;
    }

    /* Switch */
    .switch {
      position: relative;
      width: 2.75rem;
      height: 1.625rem;
      background: var(--muted);
      border-radius: 9999px;
      transition: background 0.25s ease;
      flex-shrink: 0;
    }

    .switch.active {
      background: var(--brand-primary);
    }

    .switch-thumb {
      position: absolute;
      top: 0.1875rem;
      left: 0.1875rem;
      width: 1.25rem;
      height: 1.25rem;
      border-radius: 50%;
      background: white;
      box-shadow: 0 2px 6px rgba(2,6,23,.15);
      transition: transform 0.25s ease;
    }

    .switch.active .switch-thumb {
      transform: translateX(1.125rem);
    }

    /* Featured collections */
    .featured-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    @media (min-width: 768px) {
      .featured-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    .featured-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .featured-card:hover {
      transform: translateY(-0.125rem);
      box-shadow: 0 12px 40px rgba(0,0,0,.1);
    }

    .featured-header {
      margin-bottom: 1rem;
    }

    .featured-title {
      font-size: 1.125rem;
      font-weight: 800;
      margin-bottom: 0.25rem;
    }

    .featured-subtitle {
      color: var(--muted-foreground);
      font-size: 0.875rem;
    }

    .featured-body {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    .featured-image {
      width: 4.5rem;
      height: 4.5rem;
      border-radius: 0.75rem;
      object-fit: cover;
      flex-shrink: 0;
    }

    .featured-content {
      flex: 1;
      min-width: 0;
    }

    /* Carousel */
    .carousel-container {
      position: relative;
    }

    .carousel-window {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scrollbar-width: none;
      padding-bottom: 1rem;
    }

    .carousel-window::-webkit-scrollbar {
      display: none;
    }

    .carousel-item {
      flex: none;
      width: 16rem;
      scroll-snap-align: start;
    }

    @media (min-width: 640px) {
      .carousel-item {
        width: 13rem;
      }
    }

    @media (min-width: 1024px) {
      .carousel-item {
        width: 15rem;
      }
    }

    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10;
      width: 2.25rem;
      height: 2.25rem;
      border-radius: 50%;
      background: rgba(255,255,255,.9);
      border: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0,0,0,.1);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--foreground);
      transition: all 0.2s;
    }

    .carousel-btn:hover {
      background: white;
      box-shadow: 0 6px 16px rgba(0,0,0,.12);
      transform: translateY(-50%) scale(1.05);
    }

    .carousel-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
      transform: translateY(-50%);
    }

    .carousel-btn.prev {
      left: -1.375rem;
    }

    .carousel-btn.next {
      right: -1.375rem;
    }

    @media (max-width: 767px) {
      .carousel-btn.prev {
        left: -0.625rem;
      }
      .carousel-btn.next {
        right: -0.625rem;
      }
    }

    /* Sections */
    .section {
      padding: 2rem 0;
      border-top: 1px dashed var(--border);
      margin-top: 3rem;
    }

    @media (min-width: 768px) {
      .section {
        padding: 3rem 0;
        margin-top: 4rem;
      }
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 800;
      margin-bottom: 1rem;
      font-family: 'Playfair Display', serif;
    }

    /* Content states */
    .empty-state {
      text-align: center;
      padding: 5rem 1.25rem;
      background: rgba(236, 236, 240, 0.2);
      border-radius: 1rem;
    }

    .empty-state h4 {
      font-weight: 700;
      margin-bottom: 0.5rem;
      font-family: 'Playfair Display', serif;
    }

    .empty-state p {
      color: var(--muted-foreground);
    }

    /* Tags and chips */
    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.375rem 0.75rem;
      background: var(--secondary);
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--secondary-foreground);
    }

    .tag.clickable {
      cursor: pointer;
      transition: all 0.2s;
    }

    .tag.clickable:hover {
      background: var(--accent);
      border-color: var(--border);
    }

    /* Material symbols */
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 600, 'GRAD' 0, 'opsz' 24;
      display: inline-flex;
      align-items: center;
      vertical-align: -3px;
      font-size: 1.125rem;
      line-height: 1;
    }

    /* Scroll to top button */
    .scroll-top {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      width: 3.5rem;
      height: 3.5rem;
      border-radius: 50%;
      background: var(--primary);
      color: var(--primary-foreground);
      border: none;
      box-shadow: 0 12px 40px rgba(0,0,0,.1);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transform: translateY(0.75rem) scale(0.96);
      pointer-events: none;
      transition: opacity 0.25s, transform 0.25s;
      z-index: 50;
    }

    .scroll-top.show {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    /* Toast notifications */
    .toast {
      position: fixed;
      bottom: 1.5rem;
      left: 50%;
      transform: translate(-50%, 1rem);
      background: var(--primary);
      color: var(--primary-foreground);
      padding: 0.75rem 1.125rem;
      border-radius: 0.75rem;
      box-shadow: 0 8px 30px rgba(0,0,0,.07);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s, transform 0.25s;
      z-index: 9999;
      font-weight: 700;
      font-size: 0.9375rem;
      letter-spacing: 0.0125rem;
    }

    .toast.show {
      opacity: 1;
      transform: translate(-50%, 0);
    }

    .toast.error {
      background: var(--destructive);
      color: var(--destructive-foreground);
    }

    .toast.info {
      background: #64748b;
      color: white;
    }

    /* Loading state */
    .loading {
      text-align: center;
      padding: 5rem 1.25rem;
    }

    /* Detail layout */
    .detail-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    @media (min-width: 1024px) {
      .detail-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .detail-image {
      width: 100%;
      max-width: 20rem;
      margin: 0 auto;
      aspect-ratio: 1 / 1;
      border-radius: 1.25rem;
      object-fit: cover;
    }

    .detail-section {
      padding-top: 1.25rem;
      margin-top: 1.25rem;
      border-top: 1px solid var(--muted);
    }

    .detail-section:first-of-type {
      margin-top: 0;
      padding-top: 0;
      border-top: 0;
    }

    .detail-section-title {
      font-size: 0.875rem;
      font-weight: 700;
      margin-bottom: 0.75rem;
      color: var(--foreground);
      text-transform: uppercase;
      letter-spacing: 0.05rem;
      opacity: 0.8;
    }

    /* Responsive utilities */
    .hidden { display: none; }
    .block { display: block; }
    .flex { display: flex; }
    .grid { display: grid; }

    @media (min-width: 640px) {
      .sm\:block { display: block; }
      .sm\:hidden { display: none; }
    }

    @media (min-width: 768px) {
      .md\:block { display: block; }
      .md\:hidden { display: none; }
    }

    @media (min-width: 1024px) {
      .lg\:block { display: block; }
      .lg\:hidden { display: none; }
    }

    /* Animation utilities */
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: .5; }
    }

    .transition-all {
      transition: all 0.2s;
    }

    /* Focus states */
    .btn:focus-visible,
    .perfume-card:focus-visible,
    .preference-item:focus-visible {
      outline: 2px solid var(--ring);
      outline-offset: 2px;
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
      :root {
        --border: #000;
        --muted-foreground: #555;
      }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      
      html {
        scroll-behavior: auto;
      }
    }
  </style>
</head>

<body>
  <!-- Toast container -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Scroll to top button -->
  <button id="scrollTop" class="scroll-top" aria-label="Yukarı kaydır" title="Yukarı">
    <i data-lucide="arrow-up"></i>
  </button>

  <!-- Main app container -->
  <div class="container">
    <div class="card">
      <div class="card-content">
        <!-- Header -->
        <div class="header">
          <a href="#" class="brand" id="brandLink">
            <div class="brand-logo">S</div>
            <span class="brand-text">simscent</span>
          </a>
          <button class="btn btn-primary" id="signupBtn">Kayıt Ol</button>
        </div>

        <!-- Hero Section -->
        <section id="heroSection" class="hero">
          <div class="hero-image-container">
            <div class="hero-blob-1"></div>
            <img id="heroImage" class="hero-image" 
                 src="https://images.unsplash.com/photo-1719175936556-dbd05e415913?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxsdXh1cnklMjBwZXJmdW1lJTIwYm90dGxlfGVufDF8fHx8MTc1OTI1NDgzNHww&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral"
                 alt="parfüm"/>
            <div class="hero-blob-2"></div>
          </div>
          
          <div class="hero-content">
            <h1 class="hero-title">İmza Kokunu<br/>Keşfet</h1>
            <p class="hero-description">
              Benzersiz tercihlerinle eşleşen parfümleri keşfet. Hazır koleksiyonumuzu incele ve sana en uygun eşleşmeyi bul.
            </p>

            <div class="search-container">
              <div class="search-bar">
                <input id="searchInput" class="input" type="text" 
                       placeholder="Bir parfüm ara, örn: 'Aventus'" autocomplete="off" 
                       aria-label="Parfüm ara"/>
                <button id="searchBtn" class="btn btn-primary btn-icon" title="Ara" aria-label="Ara">
                  <i data-lucide="search"></i>
                </button>
              </div>
              <div id="suggestions" class="suggestions" role="listbox" aria-label="Öneriler"></div>
            </div>

            <div class="hero-actions">
              <button class="btn btn-primary btn-lg" id="exploreBtn">Koleksiyonu Keşfet</button>
              <button class="btn btn-outline btn-lg" id="surpriseBtn">
                <i data-lucide="sparkles"></i>
                Beni Şaşırt!
              </button>
            </div>
          </div>
        </section>

        <!-- Featured Collections Section -->
        <section id="featuredSection" class="section" style="display: none;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
            <h3 class="section-title">Öne Çıkan Koleksiyonlar</h3>
            <div style="display: flex; gap: 0.5rem;">
              <button id="featPrev" class="btn btn-outline btn-sm btn-icon" aria-label="Önceki">
                <i data-lucide="chevron-left"></i>
              </button>
              <button id="featNext" class="btn btn-outline btn-sm btn-icon" aria-label="Sonraki">
                <i data-lucide="chevron-right"></i>
              </button>
            </div>
          </div>
          <div id="featuredGrid" class="featured-grid"></div>
        </section>

        <!-- Results Section -->
        <section id="resultsSection" class="section">
          <h3 class="section-title">Sonuçlar</h3>
          <div id="resultsContent">
            <div class="empty-state">
              <h4>Keşfetmeye Başla</h4>
              <p>Başlamak için yukarıdan bir parfüm arayın veya "Beni Şaşırt!" butonunu kullanın.</p>
            </div>
          </div>
        </section>

        <!-- Preferences Section -->
        <section id="preferencesSection" class="section" style="display: none;">
          <h3 class="section-title">Benzerlik Kriterleri</h3>
          <div class="card" style="box-shadow: none; border: 1px solid var(--border); margin-top: 0;">
            <div class="card-content">
              <div id="preferencesGrid" class="preferences-grid">
                <div class="preference-item" data-pref="usage">
                  <div class="preference-label-group">
                    <span class="preference-label">Kullanım Amacı</span>
                    <span class="help-icon" data-tooltip="Parfümün giyileceği ortamı tanımlar. Örn: Günlük, iş, gece.">?</span>
                  </div>
                  <div class="switch active">
                    <div class="switch-thumb"></div>
                  </div>
                </div>
                <div class="preference-item" data-pref="season">
                  <div class="preference-label-group">
                    <span class="preference-label">Mevsim</span>
                    <span class="help-icon" data-tooltip="Parfümün uygun olduğu mevsimi belirtir. Örn: Yaz, kış, ilkbahar.">?</span>
                  </div>
                  <div class="switch active">
                    <div class="switch-thumb"></div>
                  </div>
                </div>
                <div class="preference-item" data-pref="style">
                  <div class="preference-label-group">
                    <span class="preference-label">Stil</span>
                    <span class="help-icon" data-tooltip="Parfümün genel karakterini ve tarzını ifade eder. Örn: Klasik, modern, maskülen.">?</span>
                  </div>
                  <div class="switch active">
                    <div class="switch-thumb"></div>
                  </div>
                </div>
                <div class="preference-item" data-pref="family">
                  <div class="preference-label-group">
                    <span class="preference-label">Koku Ailesi</span>
                    <span class="help-icon" data-tooltip="Parfümün ana koku grubunu belirtir. Örn: Odunsu, narenciye, çiçeksi.">?</span>
                  </div>
                  <div class="switch active">
                    <div class="switch-thumb"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Similar Perfumes Section -->
        <section id="similarSection" class="section" style="display: none;">
          <h3 class="section-title">Benzeri Parfümler</h3>
          <div id="similarContainer">
            <div class="carousel-container">
              <div id="similarCarousel" class="carousel-window"></div>
              <button id="similarPrev" class="carousel-btn prev" aria-label="Önceki">
                <i data-lucide="chevron-left"></i>
              </button>
              <button id="similarNext" class="carousel-btn next" aria-label="Sonraki">
                <i data-lucide="chevron-right"></i>
              </button>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

<script>
'use strict';
(function() {
  // Initialize Lucide icons
  if (typeof lucide !== 'undefined') {
    lucide.createIcons();
  }

  // Debug flag
  const DEBUG = /[?#&]debug\b|__DEBUG__=1/.test(location.href);
  const log = Object.assign(
    function(...a) { if(DEBUG) console.log('%c[simscent]', 'color:#6366f1;font-weight:700', ...a); },
    {
      warn: (...a) => DEBUG && console.warn('[simscent]', ...a),
      error: (...a) => DEBUG && console.error('[simscent]', ...a),
      group: (l) => DEBUG && console.group(l),
      end: () => DEBUG && console.groupEnd()
    }
  );

  // Utility functions
  const q = (s, r = document) => {
    const el = r.querySelector(s);
    if (!el) throw new Error('Selector not found: ' + s);
    return el;
  };
  const qa = (s, r = document) => Array.from(r.querySelectorAll(s));
  const on = (el, ev, fn, opt) => el.addEventListener(ev, fn, opt);

  // Constants
  const KEYS = {
    usage: ['Daily', 'Business', 'Evening', 'Night Out', 'Leisure', 'Sport'],
    season: ['Spring', 'Summer', 'Fall', 'Winter'],
    style: ['Classic', 'Masculine', 'Feminine', 'Modern'],
    family: ['Animal', 'Aquatic', 'Chypre', 'Citrus', 'Creamy', 'Earthy', 'Floral', 'Fougère', 'Fresh', 'Fruity', 'Gourmand', 'Green', 'Leathery', 'Oriental', 'Powdery', 'Resinous', 'Smoky', 'Spicy', 'Sweet', 'Synthetic', 'Woody']
  };

  const LABELS = {
    Daily: 'Günlük', Business: 'İş', Evening: 'Akşam', 'Night Out': 'Gece',
    Leisure: 'Rahat', Sport: 'Spor', Spring: 'İlkbahar', Summer: 'Yaz',
    Fall: 'Sonbahar', Winter: 'Kış', Classic: 'Klasik', Masculine: 'Maskülen',
    Feminine: 'Feminen', Modern: 'Modern'
  };

  const ICONS = {
    Daily: 'sunny', Business: 'work', Evening: 'nights_stay', 'Night Out': 'nightlife',
    Leisure: 'weekend', Sport: 'directions_run', Spring: 'local_florist',
    Summer: 'sunny', Fall: 'eco', Winter: 'ac_unit', Classic: 'account_balance',
    Masculine: 'man', Feminine: 'woman', Modern: 'auto_awesome', style: 'style'
  };

  const FAMILY_TR = {
    Animal: 'Hayvansı', Aquatic: 'Akvatik', Chypre: 'Şipre', Citrus: 'Narenciye',
    Creamy: 'Kremamsı', Earthy: 'Topraksı', Floral: 'Çiçeksi', 'Fougère': 'Fujer',
    Fresh: 'Ferahlık', Fruity: 'Meyvemsi', Gourmand: 'Gurme', Green: 'Yeşil',
    Leathery: 'Deri', Oriental: 'Oryantal', Powdery: 'Pudramsı', Resinous: 'Reçineli',
    Smoky: 'Dumanlı', Spicy: 'Baharatlı', Sweet: 'Tatlı', Synthetic: 'Sentetik',
    Woody: 'Odunsu'
  };

  const ACCORD_TR = {
    'woody': 'Odunsu', 'aromatic': 'Aromatik', 'fresh spicy': 'Taze Baharatlı',
    'citrus': 'Narenciye', 'amber': 'Amber', 'warm spicy': 'Sıcak Baharatlı',
    'green': 'Yeşil', 'sweet': 'Tatlı', 'musky': 'Misk', 'fruity': 'Meyvemsi',
    'powdery': 'Pudramsı', 'vanilla': 'Vanilya', 'floral': 'Çiçeksi',
    'white floral': 'Beyaz Çiçeksi', 'rose': 'Gül', 'oud': 'Öd', 'smoky': 'Dumanlı',
    'leather': 'Deri', 'earthy': 'Topraksı', 'animalic': 'Hayvansı',
    'aquatic': 'Akvatik', 'patchouli': 'Paçuli', 'iris': 'İris',
    'balsamic': 'Balsamik', 'tobacco': 'Tütün', 'cinnamon': 'Tarçın',
    'spicy': 'Baharatlı', 'resinous': 'Reçineli', 'chypre': 'Şipre',
    'fougère': 'Fujer', 'gourmand': 'Gurme', 'creamy': 'Kremamsı',
    'synthetic': 'Sentetik', 'fresh': 'Ferah'
  };

  // Application state
  const state = {
    data: [],
    fuse: null,
    currentRef: null,
    viewMode: 'home', // 'home', 'perfume', 'category'
    categoryView: null,
    featured: { pairs: [], topMap: new Map(), topList: [], picks: [], page: 0 },
    preferences: {
      usage: true,
      season: true,
      style: true,
      family: true
    },
    similarPerfumes: []
  };

  // Utility functions
  const toPct = (v) => {
    const n = Number(v);
    return !isFinite(n) ? 0 : (n < 11 ? Math.round(n * 10) : Math.round(n));
  };

  function showToast(msg, type = 'ok') {
    const t = q('#toast');
    if (!t) {
      if (DEBUG) console.log('[toast]', msg);
      return;
    }
    t.textContent = msg;
    t.className = `toast ${type === 'error' ? 'error' : type === 'info' ? 'info' : ''} show`;
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(() => t.classList.remove('show'), 2600);
  }

  function setMeta(name, content) {
    let m = document.querySelector(`meta[name="${name}"]`);
    if (!m) {
      m = document.createElement('meta');
      m.name = name;
      document.head.appendChild(m);
    }
    m.setAttribute('content', content);
  }

  function addFullName(arr) {
    for (const p of arr) {
      const name = p['Fragrance Name'] || p.name || '';
      const conc = p.Concentration || p.concentration || '';
      p.fullName = (conc ? `${name} ${conc}` : name).trim();
      const yr = p['Release Year'] != null ? String(p['Release Year']) : '';
      p._search = [p.Brand, name, conc, yr].filter(Boolean).join(' ').toLowerCase();
    }
    return arr;
  }

  function parseFlexibleJSON(text) {
    try {
      const parsed = JSON.parse(text);
      if (Array.isArray(parsed)) return parsed;
      if (parsed && typeof parsed === 'object') {
        if (Array.isArray(parsed.data)) return parsed.data;
        if (Array.isArray(parsed.items)) return parsed.items;
      }
    } catch (_) {}
    const lines = text.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
    const arr = [];
    for (const ln of lines) {
      try {
        const o = JSON.parse(ln);
        if (o && typeof o === 'object') arr.push(o);
      } catch (_) {}
    }
    if (arr.length) return arr;
    throw new Error('Geçersiz JSON');
  }

  function buildFuse() {
    if (!state.data.length) {
      state.fuse = null;
      return;
    }
    state.fuse = new Fuse(state.data, {
      includeScore: true,
      threshold: 0.38,
      ignoreLocation: true,
      keys: [
        { name: 'fullName', weight: 0.6 },
        { name: 'Brand', weight: 0.35 },
        { name: 'Concentration', weight: 0.5 },
        { name: 'Release Year', weight: 0.25 },
        { name: 'Fragrance Name', weight: 0.6 },
        { name: '_search', weight: 1.0 }
      ]
    });
  }

  function vecSim(a, b, keys) {
    let dot = 0, n1 = 0, n2 = 0;
    for (const k of keys) {
      const x = Number(a[k] || 0) || 0;
      const y = Number(b[k] || 0) || 0;
      dot += x * y;
      n1 += x * x;
      n2 += y * y;
    }
    return (!n1 || !n2) ? 0 : dot / (Math.sqrt(n1) * Math.sqrt(n2));
  }

  function topKey(p, keys) {
    let best = null;
    let max = -1;
    for (const k of keys) {
      const v = Number(p[k] || 0);
      if (v > max) {
        max = v;
        best = k;
      }
    }
    return max > 0.01 ? best : null;
  }

  function cosine(v1, v2) {
    let dot = 0, n1 = 0, n2 = 0;
    const L = Math.min(v1.length, v2.length);
    for (let i = 0; i < L; i++) {
      const a = +v1[i] || 0;
      const b = +v2[i] || 0;
      dot += a * b;
      n1 += a * a;
      n2 += b * b;
    }
    if (!n1 || !n2) return 0;
    return dot / (Math.sqrt(n1) * Math.sqrt(n2));
  }

  function usedFamilyKeys(data) {
    return KEYS.family.filter(k => data.some(p => Number(p[k] || 0) > 0));
  }

  function buildFeaturedIndex() {
    const cats = usedFamilyKeys(state.data);
    const N = state.data.length;
    if (!N || cats.length < 2) {
      state.featured = { pairs: [], topMap: new Map(), topList: [], picks: [], page: 0 };
      return;
    }
    const vectors = new Map();
    for (const c of cats) {
      const arr = new Array(N);
      for (let i = 0; i < N; i++) arr[i] = Number(state.data[i][c] || 0) || 0;
      vectors.set(c, arr);
    }
    const allPairs = [];
    for (let i = 0; i < cats.length; i++) {
      for (let j = i + 1; j < cats.length; j++) {
        const a = cats[i], b = cats[j];
        const sim = cosine(vectors.get(a), vectors.get(b));
        allPairs.push({ a, b, sim });
      }
    }
    allPairs.sort((x, y) => y.sim - x.sim);
    let topPairs = allPairs.filter(p => isFinite(p.sim) && p.sim >= 0.35).slice(0, 10);
    if (topPairs.length < 3) topPairs = allPairs.filter(p => p.sim >= 0.20).slice(0, 10);
    if (topPairs.length < 3) topPairs = allPairs.slice(0, 10);

    const topMap = new Map();
    const topList = [];
    for (const { a, b } of topPairs) {
      let scored = state.data.map((p, idx) => {
        const score = (+p[a] || 0) + (+p[b] || 0);
        return { idx, perfume: p, score };
      }).filter(x => x.score > 0).sort((u, v) => v.score - u.score).slice(0, 20);

      if (scored.length === 0) {
        scored = state.data.map((p, idx) => {
          const ma = (p['Main Accords'] || '').toLowerCase();
          const hit = (ma.includes(a.toLowerCase()) ? 1 : 0) + (ma.includes(b.toLowerCase()) ? 1 : 0);
          return { idx, perfume: p, score: hit };
        }).filter(x => x.score > 0).sort((u, v) => v.score - u.score).slice(0, 20);
      }

      const key = `${a}|${b}`;
      topMap.set(key, scored);
      topList.push({ key, a, b, items: scored });
    }
    state.featured = { pairs: topPairs, topMap, topList, picks: [], page: 0 };
  }

  function pickFeatured(count = 3) {
    const { pairs, topMap, page } = state.featured;
    if (!pairs.length) {
      state.featured.picks = [];
      return;
    }
    const pool = pairs.slice(0, 10);
    const start = (page * count) % pool.length;
    const chosenPairs = [];
    for (let i = 0; i < count; i++) chosenPairs.push(pool[(start + i) % pool.length]);

    const picks = [];
    for (let i = 0; i < chosenPairs.length; i++) {
      const p = chosenPairs[i];
      const key = `${p.a}|${p.b}`;
      const items = topMap.get(key) || [];
      const len = Math.min(items.length, 20);
      if (len === 0) {
        picks.push({ key, a: p.a, b: p.b, choice: null, list: [], rank: null });
        continue;
      }
      let idx = Math.floor(Math.random() * len);
      for (let tries = 0; tries < 4 && picks.some(px => px.choice?.idx === items[idx]?.idx); tries++) {
        idx = Math.floor(Math.random() * len);
      }
      const choice = items[idx];
      picks.push({ key, a: p.a, b: p.b, choice, list: items, rank: idx + 1 });
    }
    state.featured.picks = picks;
  }

  function similarities(target, prefs) {
    return state.data.map(p => {
      if (p.fullName === target.fullName) return { perfume: p, similarity: -1 };
      let s = 0, w = 0;
      for (const k in prefs) {
        if (prefs[k]) {
          s += vecSim(target, p, KEYS[k]);
          w++;
        }
      }
      const avg = w ? s / w : 0;
      return { perfume: p, similarity: Math.pow(avg, 3) };
    }).filter(x => x.similarity !== -1).sort((a, b) => b.similarity - a.similarity);
  }

  function slugify(text) {
    return text.toString().toLowerCase()
      .replace(/&/g, 'and')
      .replace(/\s+/g, '-')
      .replace(/[^\w\-]+/g, '')
      .replace(/\-\-+/g, '-');
  }

  function getPlaceholderImage(brand) {
    const letter = encodeURIComponent((brand || '?').slice(0, 1));
    return `https://placehold.co/240x240/e2e8f0/64748b?text=${letter}`;
  }

  function getThumbUrl(perfume) {
    const letter = encodeURIComponent((perfume.Brand || '?').slice(0, 1));
    return perfume['Image URL'] || `https://placehold.co/40x40/e2e8f0/64748b?text=${letter}`;
  }

  // Rendering functions
  function renderScoreRing(value, label) {
    const v = Math.max(0, Math.min(100, toPct(value)));
    const R = 24;
    const C = 2 * Math.PI * R;
    const offset = C - (v / 100) * C;

    return `
      <div class="score-item">
        <div class="score-ring">
          <svg class="score-svg" viewBox="0 0 54 54">
            <circle class="score-bg" cx="27" cy="27" r="${R}"></circle>
            <circle class="score-fg" cx="27" cy="27" r="${R}" 
                    stroke-dasharray="${C}" stroke-dashoffset="${offset}"></circle>
          </svg>
          <div class="score-value">
            <span>${isNaN(v) ? '?' : v}</span>
          </div>
        </div>
        <div class="score-label">${label}</div>
      </div>
    `;
  }

  function renderPerfumeCard(perf, type) {
    const isRef = type === 'ref';
    const p = isRef ? perf : perf.perfume;
    const simTxt = isRef ? 'Referans Parfümünüz' : 
      (typeof perf.similarity === 'number' ? `${Math.round(perf.similarity * 100)}% Benzer` : 'Öneri');
    const img = p['Image URL'] || getPlaceholderImage(p.Brand || '');
    
    return `
      <div class="perfume-card ${isRef ? '' : 'clickable'}" data-perfume='${JSON.stringify(p).replace(/'/g, "&apos;")}'>
        <img class="perfume-image" src="${img}" alt="${p.fullName}" loading="lazy" 
             onerror="this.onerror=null;this.src='${getPlaceholderImage(p.Brand || '')}'"/>
        <div class="perfume-similarity">
          <div>
            <div class="perfume-brand brand-link" data-brand="${encodeURIComponent(p.Brand || '')}">${p.Brand || ''}</div>
            <div class="perfume-name">${p.fullName || ''}</div>
          </div>
          <div class="badge">${simTxt}</div>
        </div>
      </div>
    `;
  }

  function renderPerfumeDetail(p) {
    const img = p['Image URL'] || getPlaceholderImage(p.Brand || '');
    const releaseYear = p['Release Year'] && 
      p['Release Year'] !== 'N/A' && 
      p['Release Year'] !== 'Unknown' ? String(p['Release Year']) : null;
    const perfumers = (p.Perfumer || '').split(',').map(name => name.trim())
      .filter(name => name && name !== 'N/A' && name !== 'Unknown');

    const topUsage = topKey(p, KEYS.usage);
    const topSeason = topKey(p, KEYS.season);
    const topStyle = topKey(p, KEYS.style);
    const tags = [topUsage, topSeason, topStyle].filter(Boolean);

    const notes = p['Fragrance Notes'] || '';
    const accords = p['Main Accords'] || '';
    const sourceLink = p.URL ? 
      `<a href="${p.URL}" target="_blank" rel="noopener noreferrer" class="btn btn-outline" style="margin-top: 1rem;">
        <i data-lucide="external-link"></i>
        Parfumo'da Görüntüle
      </a>` : '';

    let subDetailsHTML = '';
    if (releaseYear && perfumers.length > 0) {
      const perfumerLinks = perfumers.map(name => 
        `<span class="perfumer-link" data-perfumer="${encodeURIComponent(name)}">${name}</span>`
      ).join(', ');
      subDetailsHTML = `<p style="color: var(--muted-foreground); margin-top: 0.5rem;">${releaseYear} • ${perfumerLinks}</p>`;
    } else if (releaseYear) {
      subDetailsHTML = `<p style="color: var(--muted-foreground); margin-top: 0.5rem;">${releaseYear}</p>`;
    } else if (perfumers.length > 0) {
      const perfumerLinks = perfumers.map(name => 
        `<span class="perfumer-link" data-perfumer="${encodeURIComponent(name)}">${name}</span>`
      ).join(', ');
      subDetailsHTML = `<p style="color: var(--muted-foreground); margin-top: 0.5rem;">${perfumerLinks}</p>`;
    }

    const tagsHTML = tags.length ? `
      <div class="detail-section">
        <h4 class="detail-section-title">Öne Çıkan Özellikler</h4>
        <div class="tags">
          ${tags.map(k => `
            <span class="tag">
              <span class="material-symbols-outlined">${ICONS[k] || ICONS.style || 'label'}</span>
              ${LABELS[k] || k}
            </span>
          `).join('')}
        </div>
      </div>
    ` : '';

    const notesHTML = notes ? `
      <div class="detail-section">
        <h4 class="detail-section-title">Notalar</h4>
        <div class="tags">
          ${notes.split(',').map(s => s.trim()).filter(Boolean).map(note => `
            <span class="tag clickable note-link" data-note="${encodeURIComponent(note)}">${note}</span>
          `).join('')}
        </div>
      </div>
    ` : '';

    return `
      <div class="card" style="box-shadow: 0 4px 15px rgba(0,0,0,.05); margin-top: 0;">
        <div class="card-content">
          <div class="detail-grid">
            <div>
              <img class="detail-image" src="${img}" alt="${p.fullName}" 
                   onerror="this.onerror=null;this.src='${getPlaceholderImage(p.Brand || '')}'"/>
              ${sourceLink}
              ${notesHTML}
            </div>
            <div>
              <div class="perfume-brand brand-link" data-brand="${encodeURIComponent(p.Brand || '')}">${p.Brand || '—'}</div>
              <h2 style="margin: 0.25rem 0 0 0;">${p.fullName || ''}</h2>
              ${subDetailsHTML}
              
              <div class="detail-section">
                <h4 class="detail-section-title">Ana Akordlar</h4>
                <div class="tags">
                  ${accords ? accords.split(',').map(a => a.trim()).filter(Boolean).map(accord => `
                    <span class="tag clickable accord-link" data-accord="${encodeURIComponent(accord)}">
                      ${ACCORD_TR[accord.toLowerCase()] || accord}
                    </span>
                  `).join('') : '<span class="tag" style="opacity: 0.7;">Belirtilmedi</span>'}
                </div>
              </div>
              
              ${tagsHTML}
              
              <div class="detail-section">
                <h4 class="detail-section-title">Puanlar</h4>
                <div class="score-grid">
                  ${renderScoreRing(p.Longevity || 0, 'Kalıcılık')}
                  ${renderScoreRing(p.Scent || 0, 'Koku')}
                  ${renderScoreRing(p.Sillage || 0, 'Yayılım')}
                  ${renderScoreRing(p['Value for Money'] || 0, 'Değer')}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
  }

  function renderFeaturedCollections() {
    const picks = state.featured.picks || [];
    const section = q('#featuredSection');
    const grid = q('#featuredGrid');
    
    if (!picks.length) {
      section.style.display = 'none';
      return;
    }

    section.style.display = 'block';
    grid.innerHTML = picks.map(p => {
      const perf = p.choice?.perfume;
      const img = perf?.['Image URL'] || getPlaceholderImage(perf?.Brand || '');
      const title = `${FAMILY_TR?.[p.a] || p.a} & ${FAMILY_TR?.[p.b] || p.b}`;
      const brandName = perf ? (perf.Brand || '') : '—';
      const fragName = perf ? (perf.fullName || 'Seçim bulunamadı') : 'Seçim bulunamadı';

      return `
        <div class="featured-card" ${perf ? `data-perfume='${JSON.stringify(perf).replace(/'/g, "&apos;")}'` : ''}>
          <div class="featured-header">
            <div class="featured-title">${title}</div>
            <div class="featured-subtitle">Bu ikilinin seçkisinden</div>
          </div>
          <div class="featured-body">
            <img class="featured-image" src="${img}" alt="${fragName}" loading="lazy" 
                 onerror="this.onerror=null;this.src='${getPlaceholderImage(perf?.Brand || '')}'"/>
            <div class="featured-content">
              <div class="perfume-brand brand-link" data-brand="${encodeURIComponent(brandName)}">${brandName}</div>
              <div class="perfume-name">${fragName}</div>
              ${p.rank ? `<div class="featured-subtitle" style="margin-top: 0.25rem;">
                Top 20 içinde <strong>${p.rank}.</strong> sıradaki öneri
              </div>` : ''}
            </div>
          </div>
        </div>
      `;
    }).join('');

    // Add event listeners for featured cards
    qa('.featured-card').forEach(card => {
      const perfumeData = card.dataset.perfume;
      if (perfumeData) {
        on(card, 'click', () => {
          try {
            const perfume = JSON.parse(perfumeData);
            setReferenceAndFindSimilar(perfume, true);
          } catch (e) {
            console.error('Error parsing perfume data:', e);
          }
        });
      }
    });
  }

  function renderSimilarPerfumes() {
    const section = q('#similarSection');
    const carousel = q('#similarCarousel');
    
    if (!state.similarPerfumes.length) {
      section.style.display = 'none';
      return;
    }

    section.style.display = 'block';
    carousel.innerHTML = state.similarPerfumes.map(sim => `
      <div class="carousel-item">
        ${renderPerfumeCard(sim, 'sim')}
      </div>
    `).join('');

    // Add event listeners for similar perfume cards
    qa('#similarCarousel .perfume-card').forEach((card, index) => {
      on(card, 'click', () => {
        const perfume = state.similarPerfumes[index]?.perfume;
        if (perfume) {
          setReferenceAndFindSimilar(perfume, true);
        }
      });
    });

    setupCarousel('#similarContainer');
  }

  function renderCategoryResults(title, perfumes) {
    const content = q('#resultsContent');
    
    const backButtonHandler = () => {
      if (state.currentRef) {
        state.viewMode = 'perfume';
        state.categoryView = null;
        renderCurrentView();
      } else {
        resetToHome(false);
      }
    };

    content.innerHTML = `
      <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; margin-bottom: 1.5rem;">
        <h3 style="font-weight: 800; font-size: 1.25rem; margin: 0;">${title} (${perfumes.length})</h3>
        <button class="btn btn-outline" id="categoryBackBtn">Geri Dön</button>
      </div>
      
      ${perfumes.length === 0 ? '<p style="text-align: center; color: var(--muted-foreground); padding: 2rem;">Bu kriter için sonuç bulunamadı.</p>' : `
        <div class="perfume-grid">
          ${perfumes.map(p => {
            const year = p['Release Year'] || '';
            const img = p['Image URL'] || getPlaceholderImage(p.Brand || '');
            return `
              <div class="perfume-card clickable" data-perfume='${JSON.stringify(p).replace(/'/g, "&apos;")}'>
                <img class="perfume-image" src="${img}" alt="${p.fullName}" loading="lazy" 
                     onerror="this.onerror=null;this.src='${getPlaceholderImage(p.Brand || '')}'"/>
                <div class="perfume-similarity">
                  <div>
                    <div class="perfume-brand brand-link" data-brand="${encodeURIComponent(p.Brand || '')}">${p.Brand || ''}</div>
                    <div class="perfume-name">${p.fullName || ''}</div>
                  </div>
                  ${year ? `<div class="badge badge-outline">${year}</div>` : ''}
                </div>
              </div>
            `;
          }).join('')}
        </div>
      `}
    `;

    // Add event listeners
    const backBtn = content.querySelector('#categoryBackBtn');
    if (backBtn) {
      on(backBtn, 'click', backButtonHandler);
    }

    qa('#resultsContent .perfume-card').forEach(card => {
      const perfumeData = card.dataset.perfume;
      if (perfumeData) {
        on(card, 'click', () => {
          try {
            const perfume = JSON.parse(perfumeData);
            setReferenceAndFindSimilar(perfume, true);
          } catch (e) {
            console.error('Error parsing perfume data:', e);
          }
        });
      }
    });

    setTimeout(() => {
      q('#resultsSection').scrollIntoView({ behavior: 'smooth' });
    }, 100);
  }

  function renderCurrentView() {
    const heroSection = q('#heroSection');
    const preferencesSection = q('#preferencesSection');
    const resultsContent = q('#resultsContent');
    
    if (state.viewMode === 'home') {
      heroSection.style.display = 'grid';
      preferencesSection.style.display = 'none';
      
      if (!state.currentRef) {
        const loadedText = state.data.length > 0 ? 'Koleksiyon Yüklendi' : 'Keşfetmeye Başla';
        const loadedDesc = state.data.length > 0 ? 
          'Bir parfüm arayabilir veya "Beni Şaşırt!" butonunu kullanabilirsiniz.' :
          'Başlamak için yukarıdan bir parfüm arayın veya "Beni Şaşırt!" butonunu kullanın.';
        const badge = state.data.length > 0 ? 
          `<div class="badge" style="margin-top: 0.75rem;">✅ ${state.data.length} parfüm başarıyla yüklendi</div>` : '';
        
        resultsContent.innerHTML = `
          <div class="empty-state">
            <h4>${loadedText}</h4>
            <p>${loadedDesc}</p>
            ${badge}
          </div>
        `;
      }
    } else if (state.viewMode === 'perfume' && state.currentRef) {
      heroSection.style.display = 'none';
      preferencesSection.style.display = 'block';
      resultsContent.innerHTML = `
        <div style="margin-bottom: 2rem;">
          ${renderPerfumeDetail(state.currentRef)}
        </div>
      `;
    } else if (state.viewMode === 'category' && state.categoryView) {
      heroSection.style.display = 'none';
      preferencesSection.style.display = 'none';
      renderCategoryResults(state.categoryView.title, state.categoryView.perfumes);
    }
  }

  // UI interaction functions
  function setupCarousel(containerSelector) {
    const container = document.querySelector(containerSelector);
    if (!container) return;
    
    const windowEl = container.querySelector('.carousel-window');
    const prevBtn = container.querySelector('.carousel-btn.prev');
    const nextBtn = container.querySelector('.carousel-btn.next');
    const cards = Array.from(windowEl.children);
    
    if (!cards.length) return;
    
    const checkButtons = () => {
      const canScroll = windowEl.scrollWidth > windowEl.clientWidth;
      if (prevBtn) prevBtn.style.display = canScroll ? 'flex' : 'none';
      if (nextBtn) nextBtn.style.display = canScroll ? 'flex' : 'none';
    };
    
    const updateButtons = () => {
      const atStart = windowEl.scrollLeft < 10;
      const atEnd = Math.abs(windowEl.scrollWidth - windowEl.clientWidth - windowEl.scrollLeft) < 10;
      if (prevBtn) prevBtn.disabled = atStart;
      if (nextBtn) nextBtn.disabled = atEnd;
    };
    
    if (prevBtn) {
      on(prevBtn, 'click', () => {
        const w = cards[0].offsetWidth;
        windowEl.scrollBy({ left: -(w + 16), behavior: 'smooth' });
      });
    }
    
    if (nextBtn) {
      on(nextBtn, 'click', () => {
        const w = cards[0].offsetWidth;
        windowEl.scrollBy({ left: (w + 16), behavior: 'smooth' });
      });
    }
    
    on(windowEl, 'scroll', updateButtons, { passive: true });
    
    const resizeObserver = new ResizeObserver(() => {
      checkButtons();
      updateButtons();
    });
    resizeObserver.observe(windowEl);
    
    checkButtons();
    updateButtons();
  }

  function setupSearch() {
    const input = q('#searchInput');
    const btn = q('#searchBtn');
    const suggest = q('#suggestions');
    let debounceTimer = null;

    on(input, 'input', () => {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        const query = input.value.trim();
        if (!query || !state.fuse) {
          suggest.style.display = 'none';
          return;
        }
        const results = state.fuse.search(query).slice(0, 8);
        if (!results.length) {
          suggest.style.display = 'none';
          return;
        }
        suggest.innerHTML = results.map((r, index) => {
          const item = r.item;
          const year = item['Release Year'] != null && item['Release Year'] !== '' ? String(item['Release Year']) : '';
          const brandInfo = [item.Brand, year].filter(Boolean).join(', ');
          return `
            <div class="suggestion-item" data-index="${r.refIndex}" role="option" aria-selected="false">
              <img class="suggestion-thumb" src="${getThumbUrl(item)}" alt="" loading="lazy" 
                   onerror="this.onerror=null;this.src='${getThumbUrl(item)}'"/>
              <div class="suggestion-name">${item.fullName}</div>
              ${brandInfo ? `<div class="suggestion-brand">(${brandInfo})</div>` : ''}
            </div>
          `;
        }).join('');
        suggest.style.display = 'block';
      }, 140);
    });

    on(suggest, 'click', e => {
      const el = e.target.closest('.suggestion-item');
      if (!el) return;
      const idx = parseInt(el.dataset.index, 10);
      if (!isNaN(idx) && state.data[idx]) {
        setReferenceAndFindSimilar(state.data[idx], true);
      }
      suggest.style.display = 'none';
    });

    on(document, 'click', e => {
      if (!suggest.contains(e.target) && e.target !== input) {
        suggest.style.display = 'none';
      }
    });

    on(input, 'keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
        suggest.style.display = 'none';
        handleSearch();
      }
    });

    on(btn, 'click', () => {
      suggest.style.display = 'none';
      handleSearch();
    });
  }

  function setupPreferences() {
    qa('#preferencesGrid .preference-item').forEach(item => {
      on(item, 'click', (e) => {
        if (e.target.closest('.help-icon')) return;
        
        const pref = item.dataset.pref;
        const toggle = item.querySelector('.switch');
        
        state.preferences[pref] = !state.preferences[pref];
        
        if (state.preferences[pref]) {
          toggle.classList.add('active');
        } else {
          toggle.classList.remove('active');
        }
        
        if (state.currentRef) {
          const sims = similarities(state.currentRef, state.preferences).slice(0, 10);
          state.similarPerfumes = sims;
          renderSimilarPerfumes();
        }
      });
    });
  }

  function setupEventListeners() {
    // Global click handlers for brand, perfumer, note, and accord links
    on(document, 'click', e => {
      const brandLink = e.target.closest('.brand-link');
      if (brandLink && brandLink.dataset.brand) {
        e.stopPropagation();
        handleBrandClick(decodeURIComponent(brandLink.dataset.brand));
        return;
      }

      const perfumerLink = e.target.closest('.perfumer-link');
      if (perfumerLink && perfumerLink.dataset.perfumer) {
        e.stopPropagation();
        handlePerfumerClick(decodeURIComponent(perfumerLink.dataset.perfumer));
        return;
      }

      const accordLink = e.target.closest('.accord-link');
      if (accordLink && accordLink.dataset.accord) {
        e.stopPropagation();
        handleAccordClick(decodeURIComponent(accordLink.dataset.accord));
        return;
      }

      const noteLink = e.target.closest('.note-link');
      if (noteLink && noteLink.dataset.note) {
        e.stopPropagation();
        handleNoteClick(decodeURIComponent(noteLink.dataset.note));
        return;
      }
    });

    // Brand link click
    on(q('#brandLink'), 'click', (e) => {
      e.preventDefault();
      resetToHome();
    });

    // Hero action buttons
    on(q('#exploreBtn'), 'click', handleSearch);
    on(q('#surpriseBtn'), 'click', handleSurprise);
    on(q('#signupBtn'), 'click', () => showToast('Yakında!', 'info'));

    // Featured collection navigation
    on(q('#featPrev'), 'click', () => {
      const { pairs } = state.featured;
      const count = 3;
      const pages = Math.max(1, Math.ceil(Math.min(pairs.length, 10) / count));
      state.featured.page = (state.featured.page - 1 + pages) % pages;
      pickFeatured(count);
      renderFeaturedCollections();
    });

    on(q('#featNext'), 'click', () => {
      const { pairs } = state.featured;
      const count = 3;
      const pages = Math.max(1, Math.ceil(Math.min(pairs.length, 10) / count));
      state.featured.page = (state.featured.page + 1) % pages;
      pickFeatured(count);
      renderFeaturedCollections();
    });

    // Scroll to top button
    const scrollTop = q('#scrollTop');
    const toggleScrollTop = () => {
      if (window.scrollY > 280) {
        scrollTop.classList.add('show');
      } else {
        scrollTop.classList.remove('show');
      }
    };
    on(window, 'scroll', toggleScrollTop, { passive: true });
    on(scrollTop, 'click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
    toggleScrollTop();
  }

  // Core application functions
  function setReferenceAndFindSimilar(perfume, scroll = true) {
    if (!perfume) {
      showToast('Geçerli bir parfüm seçilemedi.', 'error');
      return;
    }

    state.currentRef = perfume;
    state.viewMode = 'perfume';
    state.categoryView = null;
    q('#searchInput').value = perfume.fullName || '';

    // Update document metadata
    document.title = `${perfume.fullName} — simscent`;
    setMeta('description', `${perfume.Brand} ${perfume.fullName} notalar, akordlar ve benzer parfümler.`);

    // Update URL
    const brandSlug = slugify(perfume.Brand || 'unknown');
    const fragSlug = slugify(perfume.fullName || '');
    const newPath = `/p/${brandSlug}/${fragSlug}`;
    if (location.pathname !== newPath) {
      history.pushState({ perfume: perfume.fullName }, '', newPath);
    }

    // Calculate similarities
    const sims = similarities(perfume, state.preferences).slice(0, 10);
    state.similarPerfumes = sims;

    renderCurrentView();
    renderSimilarPerfumes();

    if (scroll) {
      setTimeout(() => {
        q('#resultsSection').scrollIntoView({ behavior: 'smooth' });
      }, 100);
    }
  }

  function handleSearch() {
    if (!state.data.length) return;
    
    const query = q('#searchInput').value.trim();
    if (!query && state.currentRef) {
      setReferenceAndFindSimilar(state.currentRef, true);
      return;
    }
    
    if (query) {
      const searchResult = state.fuse?.search(query);
      const ref = searchResult?.[0]?.item;
      if (!ref) {
        showToast('Parfüm bulunamadı. Farklı bir arama deneyin.', 'error');
        return;
      }
      setReferenceAndFindSimilar(ref, true);
      return;
    }
    
    if (!state.currentRef) {
      showToast('Lütfen bir parfüm arayın veya "Beni Şaşırt!" butonunu kullanın.', 'info');
    }
  }

  function handleSurprise() {
    if (!state.data.length) return;
    
    const randomPerfume = state.data[Math.floor(Math.random() * state.data.length)];
    if (randomPerfume['Image URL']) {
      q('#heroImage').src = randomPerfume['Image URL'];
    }
    setReferenceAndFindSimilar(randomPerfume, true);
  }

  function resetToHome(pushState = true) {
    state.currentRef = null;
    state.viewMode = 'home';
    state.categoryView = null;
    state.similarPerfumes = [];
    q('#searchInput').value = '';
    
    document.title = 'simscent — Ana Sayfa';
    setMeta('description', 'Benzersiz tercihlerinle eşleşen parfümleri keşfet. Hazır koleksiyonumuzu incele ve sana en uygun eşleşmeyi bul.');
    
    const homePath = '/';
    if (pushState && location.pathname !== homePath) {
      history.pushState({}, '', homePath);
    }

    if (state.data.length > 0) {
      const randomPerfume = state.data[Math.floor(Math.random() * state.data.length)];
      if (randomPerfume['Image URL']) {
        q('#heroImage').src = randomPerfume['Image URL'];
      }
    }

    renderCurrentView();

    if (pushState) {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  }

  function handleCategoryView(title, perfumes) {
    state.categoryView = { title, perfumes };
    state.viewMode = 'category';
    renderCurrentView();
  }

  function handleBrandClick(brand) {
    const brandPerfumes = state.data.filter(p => 
      p.Brand && p.Brand.toLowerCase() === brand.toLowerCase()
    );
    handleCategoryView(`${brand} Koleksiyonu`, brandPerfumes);
  }

  function handlePerfumerClick(perfumer) {
    const perfumerPerfumes = state.data.filter(p => 
      p.Perfumer && p.Perfumer.toLowerCase().includes(perfumer.toLowerCase())
    );
    handleCategoryView(`${perfumer} Koleksiyonu`, perfumerPerfumes);
  }

  function handleNoteClick(note) {
    const notePerfumes = state.data.filter(p => 
      p['Fragrance Notes'] && p['Fragrance Notes'].toLowerCase().includes(note.toLowerCase())
    );
    handleCategoryView(`'${note}' Notalı Parfümler`, notePerfumes);
  }

  function handleAccordClick(accord) {
    const accordPerfumes = state.data
      .filter(p => p['Main Accords'] && p['Main Accords'].toLowerCase().includes(accord.toLowerCase()))
      .sort((a, b) => (Number(b[accord]) || 0) - (Number(a[accord]) || 0))
      .slice(0, 50);
    handleCategoryView(`'${ACCORD_TR[accord.toLowerCase()] || accord}' Akorduna Sahip Parfümler`, accordPerfumes);
  }

  // URL routing
  function handleRouting() {
    const path = location.pathname;
    const regex = /^\/p\/([^/]+)\/([^/]+)/;
    const match = path.match(regex);
    
    if (!match) {
      if (state.currentRef) {
        resetToHome(false);
      }
      return;
    }

    const [, brandSlug, fragSlug] = match;
    const perfumeName = decodeURIComponent(fragSlug).replace(/-/g, ' ');
    
    if (state.currentRef && perfumeName === state.currentRef.fullName) return;
    
    if (state.fuse) {
      const result = state.fuse.search(perfumeName);
      if (result.length > 0 && result[0].item) {
        log(`URL'den bulundu: ${perfumeName}`);
        setReferenceAndFindSimilar(result[0].item, false);
      } else {
        log.warn(`URL'den parfüm bulunamadı: ${perfumeName}`);
        resetToHome();
      }
    } else {
      setTimeout(handleRouting, 200);
    }
  }

  // Data loading
  async function loadInitialData() {
    try {
      const response = await fetch('/perfumes_data.json');
      if (!response.ok) throw new Error(`HTTP hatası! Durum: ${response.status}`);
      
      const text = await response.text();
      const txt = text.replace(/:\s*NaN/gi, ': null');
      let data = parseFlexibleJSON(txt);
      
      if (!Array.isArray(data) || !data.length) {
        throw new Error('JSON dosyası boş veya geçersiz.');
      }

      data = addFullName(data);
      state.data = data;
      buildFuse();
      buildFeaturedIndex();
      pickFeatured(3);
      renderFeaturedCollections();

      // Update hero image with random perfume
      const randomPerfume = data[Math.floor(Math.random() * data.length)];
      if (randomPerfume['Image URL']) {
        q('#heroImage').src = randomPerfume['Image URL'];
      }
      
      // Update search placeholder
      q('#searchInput').placeholder = `Bir parfüm ara, örn: '${randomPerfume.fullName || 'Aventus'}'`;

      renderCurrentView();
      showToast(`✅ ${data.length} parfüm başarıyla yüklendi.`, 'ok');

      // Setup routing
      on(window, 'popstate', handleRouting);
      handleRouting();

    } catch (err) {
      log.error(err);
      showToast(`❌ Veri yüklenemedi: ${err.message}`, 'error');
      q('#resultsContent').innerHTML = `
        <div class="empty-state">
          <h4>Yükleme Başarısız</h4>
          <p>'perfumes_data.json' dosyası bulunamadı veya hatalı. Lütfen konsolu kontrol edin.</p>
        </div>
      `;
    }
  }

  // Initialize application
  function init() {
    setupEventListeners();
    setupSearch();
    setupPreferences();
    loadInitialData();
    
    // Update hero state
    renderCurrentView();
    
    // Re-initialize Lucide icons after DOM updates
    if (typeof lucide !== 'undefined') {
      const observer = new MutationObserver(() => {
        lucide.createIcons();
      });
      observer.observe(document.body, { childList: true, subtree: true });
    }
  }

  // Expose API for debugging
  window.simscent = {
    getState: () => ({
      count: state.data.length,
      hasFuse: !!state.fuse,
      currentRef: state.currentRef,
      featured: state.featured,
      viewMode: state.viewMode
    }),
    loadJSON: (txt) => {
      const data = addFullName(parseFlexibleJSON(txt));
      state.data = data;
      buildFuse();
      buildFeaturedIndex();
      pickFeatured(3);
      renderFeaturedCollections();
      log('Manual load', data.length);
    },
    nextFeatured: () => {
      const { pairs } = state.featured;
      const count = 3;
      const pages = Math.max(1, Math.ceil(Math.min(pairs.length, 10) / count));
      state.featured.page = (state.featured.page + 1) % pages;
      pickFeatured(count);
      renderFeaturedCollections();
    }
  };

  // Start the application
  init();
})();
</script>
</body>
</html>
