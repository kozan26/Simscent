<!DOCTYPE html>
<html lang="tr">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-7LCE4Z60ZB"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-7LCE4Z60ZB');
  </script>
  <link rel="icon" href="/assets/logo.svg" type="image/svg+xml">
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>simscent — Ana Sayfa</title>
  <meta name="description" content="Benzersiz tercihlerinle eşleşen parfümleri keşfet. Hazır koleksiyonumuzu incele ve sana en uygun eşleşmeyi bul."/>
  <meta name="google-adsense-account" content="ca-pub-9033780165680589">
  <link rel="canonical" href="https://www.simscent.com/"/>

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,500..700,0..1,-50..200"/>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>

  <style>
    :root {
      --brand-primary: #B99B6B;
      --brand-secondary: #A08C62;
      --text: #3a3a3a;
      --text-dark: #1a1a1a;
      --muted: #888;
      --border: #eee;
      --card: #fff;
      --shell: #f9f8f6;
      --elev-1: 0 4px 15px rgba(0,0,0,.05);
      --elev-2: 0 8px 30px rgba(0,0,0,.07);
      --elev-3: 0 12px 40px rgba(0,0,0,.1);
      --spacing-xs: 8px;
      --spacing-sm: 12px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --spacing-2xl: 48px;
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Ubuntu, sans-serif;
      color: var(--text);
      line-height: 1.6;
      background: var(--shell);
      min-height: 100vh;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: radial-gradient(hsla(0,0%,82%,.2) 1px, transparent 1px);
      background-size: 20px 20px;
      opacity: .35;
      pointer-events: none;
      z-index: 0;
    }

    /* Skip to main content link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--text-dark);
      color: white;
      padding: 8px 16px;
      text-decoration: none;
      z-index: 100;
      border-radius: 0 0 4px 0;
    }

    .skip-link:focus {
      top: 0;
    }

    /* Focus styles */
    *:focus-visible {
      outline: 3px solid var(--brand-primary);
      outline-offset: 2px;
    }

    button:focus-visible,
    a:focus-visible {
      outline-offset: 4px;
    }

    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 600, 'GRAD' 0, 'opsz' 24;
      display: inline-flex;
      align-items: center;
      vertical-align: -3px;
      font-size: 18px;
      line-height: 1;
    }

    .landing {
      max-width: 1200px;
      margin: var(--spacing-lg) auto;
      padding: var(--spacing-md);
      position: relative;
      z-index: 1;
    }

    @media (min-width: 768px) {
      .landing {
        padding: var(--spacing-xl);
      }
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      box-shadow: var(--elev-2);
      overflow: hidden;
      position: relative;
    }

    .card-inner {
      padding: var(--spacing-lg) var(--spacing-md);
    }

    @media (min-width: 768px) {
      .card-inner {
        padding: var(--spacing-xl);
      }
    }

    @media (min-width: 1024px) {
      .card-inner {
        padding: var(--spacing-2xl);
      }
    }

    /* Header */
    .top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-bottom: var(--spacing-sm);
      flex-wrap: wrap;
      gap: var(--spacing-md);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-weight: 800;
      font-size: clamp(18px, 4vw, 22px);
      letter-spacing: -0.02em;
      font-family: 'Playfair Display', serif;
      cursor: pointer;
      transition: opacity var(--transition);
    }

    .brand:hover {
      opacity: 0.8;
    }

    .logo {
      width: 32px;
      height: 32px;
      display: block;
      flex-shrink: 0;
    }

    .cta {
      border: none;
      border-radius: var(--radius-sm);
      padding: 10px 20px;
      font-weight: 700;
      font-size: 15px;
      color: #fff;
      background: var(--text);
      cursor: pointer;
      transition: all var(--transition);
      white-space: nowrap;
    }

    .cta:hover {
      background: var(--text-dark);
      transform: translateY(-1px);
      box-shadow: var(--elev-1);
    }

    /* Hero Section - Refactored */
    .hero {
      position: relative;
      min-height: 400px;
      border-radius: var(--radius-lg);
      overflow: hidden;
      margin-top: var(--spacing-lg);
      display: flex;
      align-items: center;
    }

    .hero-bg {
      position: absolute;
      inset: 0;
      z-index: 0;
    }

    .hero-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .hero-gradient {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        135deg,
        rgba(26, 26, 26, 0.85) 0%,
        rgba(58, 58, 58, 0.7) 50%,
        rgba(185, 155, 107, 0.3) 100%
      );
    }

    .hero-content {
      position: relative;
      z-index: 1;
      width: 100%;
      padding: var(--spacing-xl) var(--spacing-lg);
      color: white;
    }

    @media (min-width: 768px) {
      .hero {
        min-height: 500px;
      }
      .hero-content {
        padding: var(--spacing-2xl);
        max-width: 700px;
      }
    }

    .title {
      font-family: 'Playfair Display', serif;
      font-size: clamp(32px, 5.6vw, 56px);
      font-weight: 800;
      letter-spacing: -0.04em;
      line-height: 1.1;
      color: #fff;
      margin-bottom: var(--spacing-md);
      text-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .desc {
      color: rgba(255,255,255,0.9);
      max-width: 600px;
      font-size: clamp(15px, 2vw, 17px);
      margin-bottom: var(--spacing-lg);
      text-shadow: 0 1px 4px rgba(0,0,0,0.2);
    }

    /* Search */
    .search-wrap {
      margin: var(--spacing-lg) 0;
      max-width: 600px;
      position: relative;
      z-index: 60;
    }

    .searchbar {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 999px;
      padding: var(--spacing-sm) var(--spacing-md);
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
      transition: all var(--transition);
    }

    .searchbar:focus-within {
      background: #fff;
      box-shadow: 0 12px 48px rgba(0,0,0,0.2);
      transform: translateY(-2px);
    }

    .searchbar input {
      flex: 1;
      border: none;
      background: transparent;
      outline: none;
      font-size: 16px;
      color: var(--text);
      caret-color: var(--brand-primary);
    }

    .searchbar input::placeholder {
      color: #aaa;
    }

    .icon-btn {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: none;
      display: grid;
      place-items: center;
      background: var(--text);
      color: #fff;
      cursor: pointer;
      transition: all var(--transition);
      flex-shrink: 0;
    }

    .icon-btn:hover {
      background: var(--text-dark);
      transform: scale(1.05);
    }

    /* Actions */
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
    }

    .btn {
      border: none;
      border-radius: var(--radius-sm);
      padding: 14px 22px;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: all var(--transition);
      white-space: nowrap;
    }

    .btn.primary {
      background: rgba(255, 255, 255, 0.95);
      color: var(--text);
    }

    .btn.primary:hover {
      background: #fff;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .btn.ghost {
      background: transparent;
      color: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.4);
    }

    .btn.ghost:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.6);
    }

    .btn.secondary {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn.secondary:hover {
      background: #fafafa;
      border-color: #ccc;
    }

    /* Suggestions Dropdown */
    .suggest {
      display: none;
      position: absolute;
      left: 0;
      right: 0;
      top: calc(100% + var(--spacing-sm));
      background: #fff;
      border: 1px solid var(--border);
      border-radius: var(--spacing-md);
      box-shadow: var(--elev-3);
      max-height: 320px;
      overflow: auto;
      z-index: 70;
    }

    .suggest.show {
      display: block;
    }

    .s-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-md);
      cursor: pointer;
      transition: background var(--transition);
    }

    .s-item:hover,
    .s-item:focus {
      background: var(--shell);
    }

    .s-item:not(:last-child) {
      border-bottom: 1px solid var(--shell);
    }

    .s-thumb {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-sm);
      object-fit: cover;
      background: #e2e8f0;
      flex-shrink: 0;
    }

    .s-name {
      font-weight: 600;
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .s-brand {
      color: var(--muted);
      font-size: 13px;
      white-space: nowrap;
    }

    /* Sections */
    .section {
      padding: var(--spacing-xl) 0;
      border-top: 1px dashed #e5e7eb;
    }

    @media (min-width: 768px) {
      .section {
        padding: var(--spacing-2xl) 0;
      }
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
      flex-wrap: wrap;
      gap: var(--spacing-md);
    }

    .section h3 {
      font-weight: 800;
      font-size: clamp(20px, 3vw, 26px);
      margin: 0;
      font-family: 'Playfair Display', serif;
      color: var(--text-dark);
    }

    .search-meta {
      color: var(--muted);
      font-size: 14px;
      margin-top: var(--spacing-xs);
    }

    /* Loading State */
    .loading-state {
      text-align: center;
      padding: var(--spacing-2xl) var(--spacing-lg);
      background: var(--shell);
      border-radius: var(--radius-lg);
    }

    .spinner {
      width: 40px;
      height: 40px;
      margin: 0 auto var(--spacing-md);
      border: 4px solid var(--border);
      border-top-color: var(--brand-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-state h4 {
      font-weight: 700;
      font-size: 18px;
      color: var(--text);
      font-family: 'Playfair Display', serif;
      margin-bottom: var(--spacing-xs);
    }

    .loading-state p {
      color: var(--muted);
    }

    /* Preferences / Similarity Criteria */
    .pref-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-sm);
    }

    @media (min-width: 640px) {
      .pref-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .pref-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    .pref-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-md);
      min-height: 56px;
      border: 2px solid var(--shell);
      border-radius: var(--radius-md);
      background: #fff;
      cursor: pointer;
      transition: all var(--transition);
    }

    .pref-row:hover {
      border-color: var(--brand-primary);
      box-shadow: var(--elev-1);
    }

    .pref-row.active {
      border-color: var(--brand-primary);
      background: #fefdf9;
    }

    .lbl-wrap {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      flex: 1;
      min-width: 0;
    }

    .lbl {
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @media (min-width: 768px) {
      .lbl {
        font-size: 16px;
      }
    }

    .tooltip-trigger {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      background-color: var(--shell);
      color: var(--muted);
      border-radius: 50%;
      font-weight: 700;
      font-size: 12px;
      line-height: 1;
      cursor: help;
      user-select: none;
      flex-shrink: 0;
      transition: all var(--transition);
    }

    .tooltip-trigger:hover {
      background-color: var(--brand-primary);
      color: white;
    }

    .tooltip-trigger::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: calc(100% + 12px);
      left: 50%;
      transform: translateX(-50%) translateY(-4px);
      background-color: var(--text-dark);
      color: #fff;
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-weight: 500;
      line-height: 1.4;
      text-align: center;
      width: 200px;
      max-width: 90vw;
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition), transform var(--transition);
      z-index: 100;
      white-space: normal;
    }

    .tooltip-trigger::before {
      content: '';
      position: absolute;
      bottom: calc(100% + 2px);
      left: 50%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-top-color: var(--text-dark);
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition), transform var(--transition);
    }

    .tooltip-trigger:hover::before,
    .tooltip-trigger:hover::after {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .toggle {
      position: relative;
      width: 48px;
      height: 28px;
      background: #e2e8f0;
      border-radius: 999px;
      transition: background var(--transition);
      flex-shrink: 0;
    }

    .toggle .dot {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: #fff;
      box-shadow: 0 2px 6px rgba(2, 6, 23, .15);
      transition: transform var(--transition);
    }

    .pref-row.active .toggle {
      background: var(--brand-primary);
    }

    .pref-row.active .toggle .dot {
      transform: translateX(20px);
    }

    /* Perfume Cards */
    .pf {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
      border-radius: var(--radius-lg);
      padding: var(--spacing-sm);
      border: 1px solid var(--border);
      box-shadow: var(--elev-1);
      background: #fff;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      overflow: hidden;
      cursor: pointer;
    }

    .pf:hover {
      transform: translate3d(0, -6px, 0);
      box-shadow: var(--elev-3);
      border-color: rgba(185, 155, 107, .35);
    }

    .pf-img {
      width: 100%;
      aspect-ratio: 1/1;
      border-radius: var(--radius-md);
      object-fit: cover;
      background: #e2e8f0;
      margin: 0;
    }

    .pf-img.loading {
      background: linear-gradient(
        90deg,
        #e2e8f0 0%,
        #f1f5f9 50%,
        #e2e8f0 100%
      );
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .pf-brand {
      font-size: 12px;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      color: var(--brand-primary);
      font-weight: 700;
    }

    .pf-name {
      font-family: 'Playfair Display', serif;
      font-size: 17px;
      line-height: 1.3;
      font-weight: 700;
      color: var(--text-dark);
    }

    .badge {
      background: var(--brand-primary);
      color: #fff;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      white-space: nowrap;
    }

    .badge.neutral {
      background: var(--shell);
      color: var(--text);
      border: 1px solid var(--border);
    }

    /* Reference Detail Card */
    .ref-card-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-xl);
      align-items: start;
    }

    @media (min-width: 920px) {
      .ref-card-grid {
        grid-template-columns: 300px 1fr;
        gap: var(--spacing-2xl);
      }
    }

    .ref-card-image {
      width: 100%;
      max-width: 300px;
      margin: 0 auto;
      aspect-ratio: 1/1;
      border-radius: var(--radius-lg);
      object-fit: cover;
    }

    .ref-card-title {
      font-family: 'Playfair Display', serif;
      font-size: clamp(24px, 4vw, 32px);
      font-weight: 700;
      line-height: 1.2;
      color: var(--text-dark);
      margin: var(--spacing-xs) 0;
    }

    .ref-card-sub {
      color: var(--muted);
      font-size: 15px;
      margin-bottom: var(--spacing-lg);
    }

    .detail-section {
      padding-top: var(--spacing-lg);
      margin-top: var(--spacing-lg);
      border-top: 1px solid var(--shell);
    }

    .detail-section:first-of-type {
      margin-top: 0;
      padding-top: 0;
      border-top: 0;
    }

    .detail-section-title {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: var(--spacing-sm);
      color: var(--text);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      opacity: 0.8;
    }

    /* Chips */
    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xs);
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid var(--border);
      background: var(--shell);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      transition: all var(--transition);
    }

    .chip.clickable {
      cursor: pointer;
    }

    .chip.clickable:hover {
      background-color: #e2e8f0;
      border-color: #d1d5db;
      transform: translateY(-1px);
    }

    /* Scores */
    .scores {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-md);
      margin-top: var(--spacing-lg);
      padding-top: var(--spacing-md);
      border-top: 1px solid var(--border);
    }

    @media (min-width: 480px) {
      .scores {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    .score-item {
      text-align: center;
    }

    .ring {
      position: relative;
      width: 60px;
      height: 60px;
      margin: 0 auto var(--spacing-xs);
    }

    .svg {
      width: 60px;
      height: 60px;
      transform: rotate(-90deg);
    }

    .bg {
      fill: none;
      stroke: #eef2f7;
      stroke-width: 6;
    }

    .fg {
      fill: none;
      stroke: var(--brand-primary);
      stroke-width: 6;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.6s;
    }

    .val {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      font-weight: 800;
      font-size: 14px;
      color: var(--text-dark);
    }

    .score-label {
      font-size: 13px;
      color: var(--muted);
      font-weight: 600;
    }

    /* Links */
    .brand-link,
    .perfumer-link,
    .note-link,
    .accord-link {
      font-weight: 600;
      color: var(--brand-secondary);
      transition: color var(--transition);
      cursor: pointer;
    }

    .brand-link:hover,
    .perfumer-link:hover,
    .note-link:hover,
    .accord-link:hover {
      color: var(--brand-primary);
      text-decoration: underline;
    }

    /* Featured Collections */
    .featured-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
    }

    @media (min-width: 640px) {
      .featured-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .featured-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    .fc {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
      padding: var(--spacing-md);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      background: #fff;
      box-shadow: var(--elev-1);
      cursor: pointer;
      transition: all var(--transition);
    }

    .fc:hover {
      box-shadow: var(--elev-3);
      transform: translateY(-4px);
      border-color: rgba(185, 155, 107, .35);
    }

    .fc-head {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--spacing-sm);
    }

    .fc-title {
      font-family: 'Playfair Display', serif;
      font-size: 18px;
      font-weight: 800;
      color: var(--text-dark);
      line-height: 1.3;
    }

    .fc-sub {
      color: var(--muted);
      font-size: 13px;
      margin-top: 2px;
    }

    .fc-body {
      display: grid;
      grid-template-columns: 80px 1fr;
      gap: var(--spacing-sm);
      align-items: center;
    }

    .fc-img {
      width: 80px;
      height: 80px;
      border-radius: var(--radius-md);
      object-fit: cover;
      background: #e2e8f0;
    }

    .fc-count {
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
    }

    /* Grid Layouts */
    .perfume-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
    }

    @media (min-width: 480px) {
      .perfume-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 768px) {
      .perfume-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .perfume-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    /* Carousel */
    .carousel-container {
      position: relative;
      margin: 0 -12px;
    }

    .carousel-window {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      padding: var(--spacing-sm) var(--spacing-sm) var(--spacing-lg);
      gap: var(--spacing-md);
    }

    .carousel-window::-webkit-scrollbar {
      display: none;
    }

    .carousel-window > .pf {
      flex: 0 0 280px;
      scroll-snap-align: start;
    }

    @media (min-width: 640px) {
      .carousel-window > .pf {
        flex: 0 0 calc(50% - 12px);
      }
    }

    @media (min-width: 1024px) {
      .carousel-window > .pf {
        flex: 0 0 calc(25% - 12px);
      }
    }

    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid var(--border);
      box-shadow: var(--elev-2);
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      color: var(--text);
      transition: all var(--transition);
    }

    @media (min-width: 768px) {
      .carousel-btn {
        display: flex;
      }
    }

    .carousel-btn:hover:not(:disabled) {
      background: #fff;
      box-shadow: var(--elev-3);
      transform: translateY(-50%) scale(1.08);
    }

    .carousel-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .carousel-btn.prev {
      left: -24px;
    }

    .carousel-btn.next {
      right: -24px;
    }

    /* Toast Notifications */
    .toast {
      position: fixed;
      bottom: var(--spacing-lg);
      left: 50%;
      transform: translate(-50%, 16px);
      background: var(--text-dark);
      color: #fff;
      padding: var(--spacing-sm) var(--spacing-lg);
      border-radius: var(--radius-md);
      box-shadow: var(--elev-3);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s, transform 0.3s;
      z-index: 9999;
      font-weight: 600;
      font-size: 15px;
      max-width: 90vw;
      text-align: center;
    }

    .toast.show {
      opacity: 1;
      transform: translate(-50%, 0);
    }

    .toast.err {
      background: linear-gradient(135deg, #ef4444, #b91c1c);
    }

    .toast.info {
      background: linear-gradient(135deg, #64748b, #334155);
    }

    .toast.ok {
      background: linear-gradient(135deg, #10b981, #059669);
    }

    /* FAB */
    .fab {
      position: fixed;
      right: var(--spacing-lg);
      bottom: var(--spacing-lg);
      width: 56px;
      height: 56px;
      border: none;
      border-radius: 50%;
      display: grid;
      place-items: center;
      color: #fff;
      background: var(--text);
      box-shadow: var(--elev-3);
      cursor: pointer;
      opacity: 0;
      transform: translateY(12px) scale(0.96);
      pointer-events: none;
      transition: opacity 0.3s, transform 0.3s;
      z-index: 9998;
    }

    .fab.show {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    .fab:hover {
      background: var(--text-dark);
      transform: translateY(0) scale(1.05);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: var(--spacing-2xl) var(--spacing-lg);
      background: var(--shell);
      border-radius: var(--radius-lg);
    }

    .empty-state h4 {
      font-weight: 700;
      font-size: 18px;
      color: var(--text);
      font-family: 'Playfair Display', serif;
      margin-bottom: var(--spacing-xs);
    }

    .empty-state p {
      color: var(--muted);
      margin-top: var(--spacing-xs);
    }

    /* Utility Classes */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }

    /* ARIA Live Region */
    .aria-live {
      position: absolute;
      left: -10000px;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <a href="#main" class="skip-link">Ana içeriğe atla</a>
  
  <main class="landing" id="appRoot">
    <div class="card">
      <div class="card-inner">
        <div class="top">
          <div class="brand" role="button" tabindex="0" aria-label="Ana sayfaya dön">
            <img class="logo" src="/assets/logo.svg" alt="" width="32" height="32">
            <span>simscent</span>
          </div>
          <button class="cta" id="signupBtn">Kayıt Ol</button>
        </div>

        <section id="hero" class="hero" aria-label="Hero">
          <div class="hero-bg">
            <img id="heroShot" class="hero-img" src="https://images.unsplash.com/photo-1617839400561-d55457a29da2?q=80&w=930&auto=format&fit=crop" alt="Parfüm koleksiyonu"/>
            <div class="hero-gradient"></div>
          </div>
          <div class="hero-content">
            <h1 class="title">İmza Kokunu<br/>Keşfet</h1>
            <p class="desc">Benzersiz tercihlerinle eşleşen parfümleri keşfet. Hazır koleksiyonumuzu incele ve sana en uygun eşleşmeyi bul.</p>

            <div class="search-wrap">
              <div class="searchbar" role="search">
                <input 
                  id="searchInput" 
                  type="text" 
                  placeholder="Bir parfüm ara, örn: 'Aventus'" 
                  autocomplete="off" 
                  aria-label="Parfüm ara"
                  aria-controls="suggestions"
                  aria-expanded="false"
                />
                <button id="searchBtn" class="icon-btn" title="Ara" aria-label="Ara">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
              <div id="suggestions" class="suggest" role="listbox" aria-label="Arama önerileri"></div>
            </div>

            <div class="actions">
              <a class="btn primary" href="#results">Koleksiyonu Keşfet</a>
              <button class="btn ghost" id="surpriseBtn" type="button">
                <span class="material-symbols-outlined" style="margin-right: 4px;">casino</span>
                Rastgele Parfüm
              </button>
            </div>
          </div>
        </section>

        <section class="section" id="featured" style="display:none" aria-labelledby="featured-title">
          <div class="section-header">
            <div>
              <h3 id="featured-title">Öne Çıkan Koleksiyonlar</h3>
              <p class="search-meta" id="featuredMeta"></p>
            </div>
          </div>
          <div id="featuredGrid" class="featured-grid"></div>
        </section>

        <section class="section" id="results" aria-labelledby="results-title">
          <div class="section-header">
            <div>
              <h3 id="results-title">Sonuçlar</h3>
              <p class="search-meta" id="resultsMeta"></p>
            </div>
          </div>
          <div id="refDetailOut">
            <div class="empty-state">
              <h4>Keşfetmeye Başla</h4>
              <p>Başlamak için yukarıdan bir parfüm arayın veya "Rastgele Parfüm" butonunu kullanın.</p>
            </div>
          </div>
        </section>

        <section class="section" id="criteria-section" style="display:none" aria-labelledby="criteria-title">
          <div class="section-header">
            <div>
              <h3 id="criteria-title">Benzerlik Kriterleri</h3>
              <p class="search-meta">Bu kriterlere göre benzer parfümler önerilir</p>
            </div>
          </div>
          <div class="card" style="box-shadow:none;border:1px solid var(--border);padding:var(--spacing-md);overflow:visible;">
            <div id="prefs" class="pref-grid" role="group" aria-label="Benzerlik kriterleri">
              <div class="pref-row active" data-pref="usage" role="checkbox" aria-checked="true" tabindex="0">
                <div class="lbl-wrap">
                  <span class="lbl">Kullanım Amacı</span>
                  <span class="tooltip-trigger" data-tooltip="Parfümün giyileceği ortamı tanımlar. Örn: Günlük, iş, gece." role="tooltip">?</span>
                </div>
                <div class="toggle active" aria-hidden="true"><div class="dot"></div></div>
              </div>
              <div class="pref-row active" data-pref="season" role="checkbox" aria-checked="true" tabindex="0">
                <div class="lbl-wrap">
                  <span class="lbl">Mevsim</span>
                  <span class="tooltip-trigger" data-tooltip="Parfümün uygun olduğu mevsimi belirtir. Örn: Yaz, kış, ilkbahar." role="tooltip">?</span>
                </div>
                <div class="toggle active" aria-hidden="true"><div class="dot"></div></div>
              </div>
              <div class="pref-row active" data-pref="style" role="checkbox" aria-checked="true" tabindex="0">
                <div class="lbl-wrap">
                  <span class="lbl">Stil</span>
                  <span class="tooltip-trigger" data-tooltip="Parfümün genel karakterini ve tarzını ifade eder. Örn: Klasik, modern, maskülen." role="tooltip">?</span>
                </div>
                <div class="toggle active" aria-hidden="true"><div class="dot"></div></div>
              </div>
              <div class="pref-row active" data-pref="family" role="checkbox" aria-checked="true" tabindex="0">
                <div class="lbl-wrap">
                  <span class="lbl">Koku Ailesi</span>
                  <span class="tooltip-trigger" data-tooltip="Parfümün ana koku grubunu belirtir. Örn: Odunsu, narenciye, çiçeksi." role="tooltip">?</span>
                </div>
                <div class="toggle active" aria-hidden="true"><div class="dot"></div></div>
              </div>
            </div>
          </div>
        </section>

        <section class="section" id="similar" style="display:none" aria-labelledby="similar-title">
          <div class="section-header">
            <div>
              <h3 id="similar-title">Benzer Parfümler</h3>
              <p class="search-meta" id="similarMeta"></p>
            </div>
          </div>
          <div id="similarOut"></div>
        </section>
      </div>
    </div>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>
  <button id="fabTop" class="fab" aria-label="Yukarı kaydır" title="Yukarı">
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 5l0 14M5.5 11.5L12 5l6.5 6.5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>

  <div class="aria-live" aria-live="polite" aria-atomic="true" id="ariaLive"></div>

  <script>
'use strict';
(function() {
  // Debug mode
  const DEBUG = /[?#&]debug\b/.test(location.href);
  const log = {
    info: (...a) => DEBUG && console.log('%c[simscent]', 'color:#6366f1;font-weight:700', ...a),
    warn: (...a) => DEBUG && console.warn('[simscent]', ...a),
    error: (...a) => console.error('[simscent]', ...a),
  };

  // DOM helpers
  const q = (s, r = document) => r.querySelector(s);
  const qa = (s, r = document) => Array.from(r.querySelectorAll(s));
  const on = (el, ev, fn, opt) => el && el.addEventListener(ev, fn, opt);

  // State management
  const state = {
    data: [],
    fuse: null,
    currentRef: null,
    isLoading: false,
    featured: {
      collections: []
    }
  };

  // Constants
  const KEYS = {
    usage: ['Daily', 'Business', 'Evening', 'Night Out', 'Leisure', 'Sport'],
    season: ['Spring', 'Summer', 'Fall', 'Winter'],
    style: ['Classic', 'Masculine', 'Feminine', 'Modern'],
    family: ['Animal', 'Aquatic', 'Chypre', 'Citrus', 'Creamy', 'Earthy', 'Floral', 'Fougère', 'Fresh', 'Fruity', 'Gourmand', 'Green', 'Leathery', 'Oriental', 'Powdery', 'Resinous', 'Smoky', 'Spicy', 'Sweet', 'Synthetic', 'Woody']
  };

  const LABELS = {
    Daily: 'Günlük', Business: 'İş', Evening: 'Akşam', 'Night Out': 'Gece',
    Leisure: 'Rahat', Sport: 'Spor', Spring: 'İlkbahar', Summer: 'Yaz',
    Fall: 'Sonbahar', Winter: 'Kış', Classic: 'Klasik', Masculine: 'Maskülen',
    Feminine: 'Feminen', Modern: 'Modern'
  };

  const ICONS = {
    Daily: 'sunny', Business: 'work', Evening: 'nights_stay', 'Night Out': 'nightlife',
    Leisure: 'weekend', Sport: 'directions_run', Spring: 'local_florist',
    Summer: 'sunny', Fall: 'eco', Winter: 'ac_unit', Classic: 'account_balance',
    Masculine: 'man', Feminine: 'woman', Modern: 'auto_awesome', style: 'style'
  };

  const FAMILY_TR = {
    Animal: 'Hayvansı', Aquatic: 'Akvatik', Chypre: 'Şipre', Citrus: 'Narenciye',
    Creamy: 'Kremamsı', Earthy: 'Topraksı', Floral: 'Çiçeksi', 'Fougère': 'Fujer',
    Fresh: 'Ferahlık', Fruity: 'Meyvemsi', Gourmand: 'Gurme', Green: 'Yeşil',
    Leathery: 'Deri', Oriental: 'Oryantal', Powdery: 'Pudramsı', Resinous: 'Reçineli',
    Smoky: 'Dumanlı', Spicy: 'Baharatlı', Sweet: 'Tatlı', Synthetic: 'Sentetik',
    Woody: 'Odunsu'
  };

  const ACCORD_TR = {
    'woody': 'Odunsu', 'aromatic': 'Aromatik', 'fresh spicy': 'Taze Baharatlı',
    'citrus': 'Narenciye', 'amber': 'Amber', 'warm spicy': 'Sıcak Baharatlı',
    'green': 'Yeşil', 'sweet': 'Tatlı', 'musky': 'Misk', 'fruity': 'Meyvemsi',
    'powdery': 'Pudramsı', 'vanilla': 'Vanilya', 'floral': 'Çiçeksi',
    'white floral': 'Beyaz Çiçeksi', 'rose': 'Gül', 'oud': 'Öd', 'smoky': 'Dumanlı',
    'leather': 'Deri', 'earthy': 'Topraksı', 'animalic': 'Hayvansı',
    'aquatic': 'Akvatik', 'patchouli': 'Paçuli', 'iris': 'İris',
    'balsamic': 'Balsamik', 'tobacco': 'Tütün', 'cinnamon': 'Tarçın',
    'spicy': 'Baharatlı', 'resinous': 'Reçineli', 'chypre': 'Şipre',
    'fougère': 'Fujer', 'gourmand': 'Gurme', 'creamy': 'Kremamsı',
    'synthetic': 'Sentetik', 'fresh': 'Ferah'
  };

  // Utility functions
  const toPct = (v) => {
    const n = Number(v);
    return !isFinite(n) ? 0 : (n < 11 ? Math.round(n * 10) : Math.round(n));
  };

  function showToast(msg, type = 'ok') {
    const t = q('#toast');
    if (!t) {
      log.info('[toast]', msg);
      return;
    }
    t.textContent = msg;
    t.className = `toast ${type} show`;
    
    // Announce to screen readers
    announceToScreenReader(msg);
    
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(() => t.classList.remove('show'), 3000);
  }

  function announceToScreenReader(message) {
    const liveRegion = q('#ariaLive');
    if (liveRegion) {
      liveRegion.textContent = message;
      setTimeout(() => liveRegion.textContent = '', 1000);
    }
  }

  function setMeta(name, content) {
    let m = document.querySelector(`meta[name="${name}"]`);
    if (!m) {
      m = document.createElement('meta');
      m.name = name;
      document.head.appendChild(m);
    }
    m.setAttribute('content', content);
  }

  // Data processing
  function addFullName(arr) {
    for (const p of arr) {
      const name = p['Fragrance Name'] || p.name || '';
      const conc = p.Concentration || p.concentration || '';
      p.fullName = (conc ? `${name} ${conc}` : name).trim();
      const yr = p['Release Year'] != null ? String(p['Release Year']) : '';
      p._search = [p.Brand, name, conc, yr].filter(Boolean).join(' ').toLowerCase();
    }
    return arr;
  }

  function parseFlexibleJSON(text) {
    try {
      const parsed = JSON.parse(text);
      if (Array.isArray(parsed)) return parsed;
      if (parsed && typeof parsed === 'object') {
        if (Array.isArray(parsed.data)) return parsed.data;
        if (Array.isArray(parsed.items)) return parsed.items;
      }
    } catch (_) {}
    
    const lines = text.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
    const arr = [];
    for (const ln of lines) {
      try {
        const o = JSON.parse(ln);
        if (o && typeof o === 'object') arr.push(o);
      } catch (_) {}
    }
    if (arr.length) return arr;
    throw new Error('Geçersiz JSON');
  }

  function buildFuse() {
    if (!state.data.length) {
      state.fuse = null;
      return;
    }
    state.fuse = new Fuse(state.data, {
      includeScore: true,
      threshold: 0.38,
      ignoreLocation: true,
      keys: [
        { name: 'fullName', weight: 0.6 },
        { name: 'Brand', weight: 0.35 },
        { name: 'Concentration', weight: 0.5 },
        { name: 'Release Year', weight: 0.25 },
        { name: 'Fragrance Name', weight: 0.6 },
        { name: '_search', weight: 1.0 }
      ]
    });
  }

  // Similarity algorithm
  function vecSim(a, b, keys) {
    let dot = 0, n1 = 0, n2 = 0;
    for (const k of keys) {
      const x = Number(a[k] || 0) || 0;
      const y = Number(b[k] || 0) || 0;
      dot += x * y;
      n1 += x * x;
      n2 += y * y;
    }
    return (!n1 || !n2) ? 0 : dot / (Math.sqrt(n1) * Math.sqrt(n2));
  }

  function topKey(p, keys) {
    let best = null, max = -1;
    for (const k of keys) {
      const v = Number(p[k] || 0);
      if (v > max) {
        max = v;
        best = k;
      }
    }
    return max > 0.01 ? best : null;
  }

  function similarities(target, prefs) {
    const weights = {
      family: prefs.family ? 2.0 : 0,
      usage: prefs.usage ? 1.0 : 0,
      season: prefs.season ? 0.8 : 0,
      style: prefs.style ? 0.6 : 0
    };

    return state.data
      .map(p => {
        if (p.fullName === target.fullName) return { perfume: p, similarity: -1 };
        
        let score = 0, totalWeight = 0;
        for (const k in weights) {
          if (weights[k] > 0) {
            score += vecSim(target, p, KEYS[k]) * weights[k];
            totalWeight += weights[k];
          }
        }
        
        const avg = totalWeight ? score / totalWeight : 0;
        return { perfume: p, similarity: Math.pow(avg, 2.5) };
      })
      .filter(x => x.similarity !== -1)
      .sort((a, b) => b.similarity - a.similarity);
  }

  // Featured collections
  function usedFamilyKeys(data) {
    return KEYS.family.filter(k => data.some(p => Number(p[k] || 0) > 0));
  }

  function cosine(v1, v2) {
    let dot = 0, n1 = 0, n2 = 0;
    const L = Math.min(v1.length, v2.length);
    for (let i = 0; i < L; i++) {
      const a = +v1[i] || 0, b = +v2[i] || 0;
      dot += a * b;
      n1 += a * a;
      n2 += b * b;
    }
    return (!n1 || !n2) ? 0 : dot / (Math.sqrt(n1) * Math.sqrt(n2));
  }

  function buildFeaturedCollections() {
    const cats = usedFamilyKeys(state.data);
    const N = state.data.length;
    
    if (!N || cats.length < 2) {
      state.featured.collections = [];
      return;
    }

    const vectors = new Map();
    for (const c of cats) {
      const arr = new Array(N);
      for (let i = 0; i < N; i++) {
        arr[i] = Number(state.data[i][c] || 0) || 0;
      }
      vectors.set(c, arr);
    }

    const allPairs = [];
    for (let i = 0; i < cats.length; i++) {
      for (let j = i + 1; j < cats.length; j++) {
        const a = cats[i], b = cats[j];
        const sim = cosine(vectors.get(a), vectors.get(b));
        allPairs.push({ a, b, sim });
      }
    }

    allPairs.sort((x, y) => y.sim - x.sim);
    let topPairs = allPairs.filter(p => isFinite(p.sim) && p.sim >= 0.35).slice(0, 6);
    if (topPairs.length < 3) topPairs = allPairs.filter(p => p.sim >= 0.20).slice(0, 6);
    if (topPairs.length < 3) topPairs = allPairs.slice(0, 6);

    state.featured.collections = topPairs.map(({ a, b }) => {
      const items = state.data
        .map((p, idx) => {
          const score = (+p[a] || 0) + (+p[b] || 0);
          return { idx, perfume: p, score };
        })
        .filter(x => x.score > 0)
        .sort((u, v) => v.score - u.score)
        .slice(0, 20);

      return {
        key: `${a}|${b}`,
        a,
        b,
        items,
        count: items.length
      };
    }).filter(c => c.items.length > 0);
  }

  // Rendering functions
  function scoreCircle(value, label) {
    const v = Math.max(0, Math.min(100, toPct(value)));
    const R = 27, C = 2 * Math.PI * R, off = C - (v / 100) * C;
    return `
      <div class='score-item'>
        <div class='ring'>
          <svg class='svg' viewBox='0 0 60 60'>
            <circle class='bg' cx='30' cy='30' r='${R}'></circle>
            <circle class='fg' cx='30' cy='30' r='${R}' stroke-dasharray='${C}' stroke-dashoffset='${off}'></circle>
          </svg>
          <div class='val'>${isNaN(v) ? '?' : v}</div>
        </div>
        <div class='score-label'>${label}</div>
      </div>`;
  }

  function renderCard(perf, type) {
    const isRef = type === 'ref';
    const p = isRef ? perf : perf.perfume;
    const simTxt = isRef ? 'Referans' : (typeof perf.similarity === 'number' ? `${Math.round(perf.similarity * 100)}% Benzer` : 'Öneri');
    const img = p['Image URL'] || `https://placehold.co/240x240/e2e8f0/64748b?text=${encodeURIComponent((p.Brand || '?').slice(0, 1))}`;
    
    const el = document.createElement('div');
    el.className = 'pf';
    el.setAttribute('role', 'article');
    el.setAttribute('aria-label', `${p.fullName} parfümü`);
    if (!isRef) {
      el.setAttribute('tabindex', '0');
    }
    
    const imgEl = document.createElement('img');
    imgEl.className = 'pf-img loading';
    imgEl.src = img;
    imgEl.alt = p.fullName || 'Parfüm';
    imgEl.loading = 'lazy';
    imgEl.onload = () => imgEl.classList.remove('loading');
    imgEl.onerror = function() {
      this.onerror = null;
      this.src = 'https://placehold.co/240x240/e2e8f0/64748b?text=?';
      this.classList.remove('loading');
    };
    
    const content = document.createElement('div');
    content.innerHTML = `
      <div style='display:flex;justify-content:space-between;align-items:flex-start;gap:8px'>
        <div class='pf-brand brand-link' data-brand="${encodeURIComponent(p.Brand || '')}" tabindex="0" role="link">${p.Brand || ''}</div>
        <div class='badge ${isRef ? '' : 'neutral'}'>${simTxt}</div>
      </div>
      <div class='pf-name' style="margin-top:4px">${p.fullName || ''}</div>`;
    
    el.appendChild(imgEl);
    el.appendChild(content);
    
    if (!isRef) {
      el.style.cursor = 'pointer';
      const clickHandler = () => setReferenceAndFindSimilar(p, true);
      on(el, 'click', clickHandler);
      on(el, 'keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          clickHandler();
        }
      });
    }
    
    return el;
  }

  function renderRefDetail(p) {
    const img = p['Image URL'] || `https://placehold.co/480x480/e2e8f0/64748b?text=${encodeURIComponent((p.Brand || '?').slice(0, 1))}`;
    const lon = toPct(p.Longevity);
    const scent = toPct(p.Scent);
    const sil = toPct(p.Sillage);
    const val = toPct(p['Value for Money']);
    
    const sourceLink = p.URL ? `<a href='${p.URL}' target='_blank' rel='noopener noreferrer' class='btn secondary' style='display:flex;align-items:center;gap:8px;justify-content:center;width:100%;margin-top:16px;'>
      <span class="material-symbols-outlined">open_in_new</span>
      Parfumo'da Görüntüle
    </a>` : '';

    const releaseYear = p['Release Year'] && p['Release Year'] !== 'N/A' && p['Release Year'] !== 'Unknown' ? String(p['Release Year']) : null;
    const perfumers = (p.Perfumer || '').split(',').map(name => name.trim()).filter(name => name && name !== 'N/A' && name !== 'Unknown');
    
    let subDetailsHTML = '';
    const perfumerLinks = perfumers.map(name => `<span class='perfumer-link' data-perfumer='${encodeURIComponent(name)}' tabindex="0" role="link">${name}</span>`).join(', ');

    if (releaseYear && perfumers.length > 0) {
      subDetailsHTML = `<p class='ref-card-sub'>${releaseYear} • ${perfumerLinks}</p>`;
    } else if (releaseYear) {
      subDetailsHTML = `<p class='ref-card-sub'>${releaseYear}</p>`;
    } else if (perfumers.length > 0) {
      subDetailsHTML = `<p class='ref-card-sub'>${perfumerLinks}</p>`;
    }

    const topUsage = topKey(p, KEYS.usage);
    const topSeason = topKey(p, KEYS.season);
    const topStyle = topKey(p, KEYS.style);
    const tags = [topUsage, topSeason, topStyle].filter(Boolean);
    
    const tagsHTML = tags.length ? `
      <div class="detail-section">
        <h4 class='detail-section-title'>Öne Çıkan Özellikler</h4>
        <div class='chips'>
          ${tags.map(k => `<span class='chip'>
            <span class="material-symbols-outlined">${ICONS[k] || ICONS.style || 'label'}</span>
            ${LABELS[k] || k}
          </span>`).join('')}
        </div>
      </div>` : '';

    const notes = p['Fragrance Notes'] || '';
    const notesHTML = notes ? `
      <div class="detail-section">
        <h4 class='detail-section-title'>Notalar</h4>
        <div class='chips'>
          ${notes.split(',').map(s => s.trim()).filter(Boolean).map(note =>
            `<span class='chip clickable note-link' data-note='${encodeURIComponent(note)}' tabindex="0" role="link">${note}</span>`
          ).join('')}
        </div>
      </div>` : '';

    const el = document.createElement('div');
    el.className = 'card';
    el.style.boxShadow = 'var(--elev-1)';
    el.innerHTML = `
      <div class="card-inner">
        <div class="ref-card-grid">
          <div>
            <img class='ref-card-image' src='${img}' alt='${p.fullName}' onerror="this.onerror=null;this.src='https://placehold.co/300x300/e2e8f0/64748b?text=?'"/>
            ${sourceLink}
            ${notesHTML}
          </div>
          <div>
            <div class='pf-brand brand-link' data-brand="${encodeURIComponent(p.Brand || '')}" tabindex="0" role="link">${p.Brand || '—'}</div>
            <h2 class='ref-card-title'>${p.fullName || ''}</h2>
            ${subDetailsHTML}
            <div class="detail-section">
              <h4 class='detail-section-title'>Ana Akordlar</h4>
              <div class='chips'>
                ${(p['Main Accords'] || '').split(',').map(s => s.trim()).filter(Boolean).map(a =>
                  `<span class='chip clickable accord-link' data-accord='${encodeURIComponent(a)}' tabindex="0" role="link">${ACCORD_TR[a.toLowerCase()] || a}</span>`
                ).join('') || '<span class="chip" style="opacity:.7">Belirtilmedi</span>'}
              </div>
            </div>
            ${tagsHTML}
            <div class="detail-section">
              <h4 class='detail-section-title'>Puanlar</h4>
              <div class='scores'>
                ${scoreCircle(lon, 'Kalıcılık')}
                ${scoreCircle(scent, 'Koku')}
                ${scoreCircle(sil, 'Yayılım')}
                ${scoreCircle(val, 'Değer')}
              </div>
            </div>
          </div>
        </div>
      </div>`;
    return el;
  }

  function setupCarousel(container) {
    const windowEl = container.querySelector('.carousel-window');
    const prevBtn = container.querySelector('.carousel-btn.prev');
    const nextBtn = container.querySelector('.carousel-btn.next');
    
    if (!windowEl || !prevBtn || !nextBtn) return;
    
    const cards = Array.from(windowEl.children);
    if (!cards.length) return;

    const check = () => {
      const canScroll = windowEl.scrollWidth > windowEl.clientWidth;
      prevBtn.style.display = canScroll ? 'flex' : 'none';
      nextBtn.style.display = canScroll ? 'flex' : 'none';
    };

    const update = () => {
      const atStart = windowEl.scrollLeft < 10;
      const atEnd = Math.abs(windowEl.scrollWidth - windowEl.clientWidth - windowEl.scrollLeft) < 10;
      prevBtn.disabled = atStart;
      nextBtn.disabled = atEnd;
    };

    prevBtn.addEventListener('click', () => {
      const w = cards[0] ? cards[0].offsetWidth : 280;
      windowEl.scrollBy({ left: -(w + 16), behavior: 'smooth' });
    });

    nextBtn.addEventListener('click', () => {
      const w = cards[0] ? cards[0].offsetWidth : 280;
      windowEl.scrollBy({ left: (w + 16), behavior: 'smooth' });
    });

    windowEl.addEventListener('scroll', update, { passive: true });
    new ResizeObserver(() => {
      check();
      update();
    }).observe(windowEl);

    check();
    update();
  }

  function renderSimilar(sims) {
    const simSec = q('#similar');
    const container = q('#similarOut');
    const meta = q('#similarMeta');
    
    container.innerHTML = '';
    
    if (!sims.length) {
      simSec.style.display = 'none';
      return;
    }

    meta.textContent = `${sims.length} benzer parfüm bulundu`;
    
    const carouselContainer = document.createElement('div');
    carouselContainer.className = 'carousel-container';
    carouselContainer.innerHTML = `
      <div class="carousel-window"></div>
      <button class="carousel-btn prev" aria-label="Önceki">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
      </button>
      <button class="carousel-btn next" aria-label="Sonraki">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"/>
        </svg>
      </button>`;
    
    const windowEl = carouselContainer.querySelector('.carousel-window');
    sims.forEach(s => windowEl.appendChild(renderCard(s, 'sim')));
    
    container.appendChild(carouselContainer);
    simSec.style.display = 'block';
    setupCarousel(carouselContainer);
  }

  function render(ref, sims) {
    state.currentRef = ref;
    const refOut = q('#refDetailOut');
    const meta = q('#resultsMeta');
    
    refOut.innerHTML = '';
    refOut.appendChild(renderRefDetail(ref));
    
    meta.textContent = `${ref.Brand} - ${ref.fullName}`;
    
    renderSimilar(sims);
    
    // Show criteria section
    q('#criteria-section').style.display = 'block';
  }

  function renderCategoryGrid({ title, results, onBack }) {
    const refOut = q('#refDetailOut');
    const meta = q('#resultsMeta');
    
    refOut.innerHTML = '';
    q('#criteria-section').style.display = 'none';
    q('#similar').style.display = 'none';

    const header = document.createElement('div');
    header.style.cssText = 'display:flex; justify-content:space-between; align-items:center; margin-bottom:24px; flex-wrap:wrap; gap:16px;';

    const titleEl = document.createElement('h3');
    titleEl.style.cssText = "font-weight:800;font-size:22px;font-family:'Playfair Display',serif; margin:0;";
    titleEl.textContent = title;

    const backBtn = document.createElement('button');
    backBtn.className = 'btn secondary';
    backBtn.innerHTML = '<span class="material-symbols-outlined" style="margin-right:4px;">arrow_back</span>Geri Dön';
    on(backBtn, 'click', onBack);

    header.appendChild(titleEl);
    header.appendChild(backBtn);
    refOut.appendChild(header);

    meta.textContent = `${results.length} sonuç`;

    if (!results.length) {
      refOut.innerHTML += '<div class="empty-state"><h4>Sonuç Bulunamadı</h4><p>Bu kriter için sonuç bulunamadı.</p></div>';
      return;
    }

    const grid = document.createElement('div');
    grid.className = 'perfume-grid';

    results.forEach(p => {
      const year = p['Release Year'] || '';
      const img = p['Image URL'] || `https://placehold.co/240x240/e2e8f0/64748b?text=${encodeURIComponent((p.Brand || '?').slice(0, 1))}`;
      const el = document.createElement('div');
      el.className = 'pf';
      el.setAttribute('tabindex', '0');
      el.setAttribute('role', 'article');
      
      const imgEl = document.createElement('img');
      imgEl.className = 'pf-img loading';
      imgEl.src = img;
      imgEl.alt = p.fullName || 'Parfüm';
      imgEl.loading = 'lazy';
      imgEl.onload = () => imgEl.classList.remove('loading');
      imgEl.onerror = function() {
        this.onerror = null;
        this.src = 'https://placehold.co/240x240/e2e8f0/64748b?text=?';
        this.classList.remove('loading');
      };
      
      const content = document.createElement('div');
      content.innerHTML = `
        <div style='display:flex;justify-content:space-between;align-items:flex-start;gap:8px'>
          <div class='pf-brand brand-link' data-brand="${encodeURIComponent(p.Brand || '')}" tabindex="0" role="link">${p.Brand || ''}</div>
          ${year ? `<div class='badge neutral'>${year}</div>` : ''}
        </div>
        <div class='pf-name' style="margin-top:4px">${p.fullName || ''}</div>`;
      
      el.appendChild(imgEl);
      el.appendChild(content);
      
      const clickHandler = () => setReferenceAndFindSimilar(p, true);
      on(el, 'click', clickHandler);
      on(el, 'keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          clickHandler();
        }
      });
      
      grid.appendChild(el);
    });
    
    refOut.appendChild(grid);
    q('#results').scrollIntoView({ behavior: 'smooth' });
  }

  function showPerfumerResults(name) {
    renderCategoryGrid({
      title: `${name} Koleksiyonu`,
      results: state.data.filter(p => p.Perfumer && p.Perfumer.toLowerCase().includes(name.toLowerCase())),
      onBack: () => findSimilar(false)
    });
  }

  function showBrandResults(brandName) {
    renderCategoryGrid({
      title: `${brandName} Koleksiyonu`,
      results: state.data.filter(p => p.Brand && p.Brand.toLowerCase() === brandName.toLowerCase()),
      onBack: () => findSimilar(false)
    });
  }

  function showAccordResults(accordName) {
    const results = state.data
      .filter(p => p['Main Accords'] && p['Main Accords'].toLowerCase().includes(accordName.toLowerCase()))
      .sort((a, b) => (b[accordName] || 0) - (a[accordName] || 0))
      .slice(0, 50);
    renderCategoryGrid({
      title: `'${ACCORD_TR[accordName.toLowerCase()] || accordName}' Akorduna Sahip Parfümler`,
      results: results,
      onBack: () => findSimilar(false)
    });
  }

  function showNoteResults(noteName) {
    renderCategoryGrid({
      title: `'${noteName}' Notalı Parfümler`,
      results: state.data.filter(p => p['Fragrance Notes'] && p['Fragrance Notes'].toLowerCase().includes(noteName.toLowerCase())),
      onBack: () => findSimilar(false)
    });
  }

  function renderFeatured() {
    const sec = q('#featured');
    const grid = q('#featuredGrid');
    const meta = q('#featuredMeta');
    
    grid.innerHTML = '';
    const collections = state.featured.collections || [];
    
    if (!collections.length) {
      sec.style.display = 'none';
      return;
    }

    sec.style.display = 'block';
    meta.textContent = `${collections.length} koleksiyon`;

    collections.slice(0, 6).forEach(col => {
      const sample = col.items[0]?.perfume;
      const img = sample?.['Image URL'] || `https://placehold.co/144x144/e2e8f0/64748b?text=${encodeURIComponent((sample?.Brand || '?').slice(0, 1))}`;
      const title = `${(FAMILY_TR?.[col.a] || col.a)} & ${(FAMILY_TR?.[col.b] || col.b)}`;
      
      const el = document.createElement('div');
      el.className = 'fc';
      el.setAttribute('tabindex', '0');
      el.setAttribute('role', 'article');
      
      el.innerHTML = `
        <div class="fc-head">
          <div>
            <div class="fc-title">${title}</div>
            <div class="fc-sub">Bu ikilinin seçkisinden</div>
          </div>
        </div>
        <div class="fc-body">
          <img class="fc-img" src="${img}" alt="${sample?.fullName || 'Parfüm'}" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/80x80/e2e8f0/64748b?text=?'"/>
          <div>
            <div class="pf-brand brand-link" style="margin-bottom:4px" data-brand="${encodeURIComponent(sample?.Brand || '')}" tabindex="0" role="link">${sample?.Brand || '—'}</div>
            <div class="pf-name">${sample?.fullName || 'Seçim bulunamadı'}</div>
            <div class="fc-count" style="margin-top:4px">${col.count} parfüm</div>
          </div>
        </div>`;
      
      const clickHandler = () => {
        if (!sample) return;
        setReferenceAndFindSimilar(sample, true);
      };
      
      on(el, 'click', clickHandler);
      on(el, 'keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          clickHandler();
        }
      });
      
      grid.appendChild(el);
    });
  }

  // Core functionality
  function setReferenceAndFindSimilar(ref, scroll = true) {
    if (!ref) {
      showToast('Geçerli bir parfüm seçilemedi.', 'err');
      return;
    }

    state.currentRef = ref;
    q('#searchInput').value = ref.fullName;
    
    document.title = `${ref.fullName} — simscent`;
    setMeta('description', `${ref.Brand} ${ref.fullName} notalar, akordlar ve benzer parfümler.`);

    const slugify = (text) => text.toString().toLowerCase()
      .replace(/&/g, 'and')
      .replace(/\s+/g, '-')
      .replace(/[^\w\-]+/g, '')
      .replace(/\-\-+/g, '-');

    const brandSlug = slugify(ref.Brand || 'unknown');
    const fragSlug = slugify(ref.fullName);
    const newPath = `/p/${brandSlug}/${fragSlug}`;
    
    if (location.pathname !== newPath) {
      history.pushState({ perfume: ref.fullName }, '', newPath);
    }

    const prefs = {
      usage: q('.pref-row[data-pref="usage"]').classList.contains('active'),
      season: q('.pref-row[data-pref="season"]').classList.contains('active'),
      style: q('.pref-row[data-pref="style"]').classList.contains('active'),
      family: q('.pref-row[data-pref="family"]').classList.contains('active')
    };

    const sims = similarities(ref, prefs).slice(0, 20);
    render(ref, sims);
    
    if (scroll) {
      q('#results').scrollIntoView({ behavior: 'smooth' });
    }

    renderFeatured();
  }

  function findSimilar(scroll = true) {
    if (!state.data.length) return;
    
    const qv = q('#searchInput').value.trim();
    
    if (!qv && state.currentRef) {
      setReferenceAndFindSimilar(state.currentRef, scroll);
      return;
    }
    
    if (qv) {
      const searchResult = state.fuse?.search(qv);
      const ref = searchResult?.[0]?.item;
      
      if (!ref) {
        showToast('Parfüm bulunamadı. Farklı bir arama deneyin.', 'err');
        return;
      }
      
      setReferenceAndFindSimilar(ref, scroll);
      return;
    }
    
    if (!state.currentRef) {
      showToast('Lütfen bir parfüm arayın veya "Rastgele Parfüm" butonunu kullanın.', 'info');
    }
  }

  function handleSurprise() {
    if (!state.data.length) return;
    
    const idx = Math.floor(Math.random() * state.data.length);
    const p = state.data[idx];
    setHeroFromPerfume(p);
    setReferenceAndFindSimilar(p, true);
  }

  function resetToHome(pushState = true) {
    state.currentRef = null;
    q('#searchInput').value = '';
    q('#criteria-section').style.display = 'none';
    q('#similar').style.display = 'none';
    
    document.title = 'simscent — Ana Sayfa';
    setMeta('description', 'Benzersiz tercihlerinle eşleşen parfümleri keşfet. Hazır koleksiyonumuzu incele ve sana en uygun eşleşmeyi bul.');
    
    const homePath = '/';
    if (pushState && location.pathname !== homePath) {
      history.pushState({}, '', homePath);
    }

    if (state.data.length > 0) {
      const idx = Math.floor(Math.random() * state.data.length);
      const rnd = state.data[idx];
      setHeroFromPerfume(rnd);
    }

    const refOut = q('#refDetailOut');
    const meta = q('#resultsMeta');
    
    refOut.innerHTML = `
      <div class="empty-state">
        <h4>Koleksiyon Hazır</h4>
        <p>Bir parfüm arayabilir veya "Rastgele Parfüm" butonunu kullanabilirsiniz.</p>
      </div>`;
    meta.textContent = '';

    if (pushState) {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  }

  function setHeroFromPerfume(p) {
    const shot = q('#heroShot');
    const img = p['Image URL'] || '';
    
    if (img) {
      shot.src = img;
      shot.alt = p.fullName || 'parfüm';
      shot.onerror = function() {
        this.onerror = null;
        this.src = 'https://images.unsplash.com/photo-1523292562811-8fa7962a78c8?q=80&w=1200&auto=format&fit=crop';
      };
    }
    
    q('#searchInput').placeholder = `Bir parfüm ara, örn: '${p.fullName || 'Aventus'}'`;
  }

  function handleRealRouting() {
    const path = location.pathname;
    const regex = /^\/p\/([^/]+)\/([^/]+)/;
    const match = path.match(regex);
    
    if (!match) {
      if (state.currentRef) {
        resetToHome(false);
      }
      return;
    }
    
    const [, brandSlug, fragSlug] = match;
    const perfumeName = decodeURIComponent(fragSlug).replace(/-/g, ' ');
    
    if (state.currentRef && perfumeName === state.currentRef.fullName) return;
    
    if (state.fuse) {
      const result = state.fuse.search(perfumeName);
      if (result.length > 0 && result[0].item) {
        log.info(`Route parfümü bulundu: ${perfumeName}`);
        setReferenceAndFindSimilar(result[0].item, true);
      } else {
        log.warn(`Route parfümü bulunamadı: ${perfumeName}`);
        resetToHome();
      }
    } else {
      setTimeout(handleRealRouting, 200);
    }
  }

  function setLoadingState(message = 'Yükleniyor...') {
    state.isLoading = true;
    const refOut = q('#refDetailOut');
    refOut.innerHTML = `
      <div class="loading-state">
        <div class="spinner"></div>
        <h4>Veri Yükleniyor</h4>
        <p>${message}</p>
      </div>`;
  }

  async function loadInitialData() {
    try {
      setLoadingState('Parfüm koleksiyonu hazırlanıyor...');
      
      const response = await fetch('/perfumes_data.json');
      if (!response.ok) throw new Error(`HTTP hatası! Durum: ${response.status}`);
      
      const text = await response.text();
      const txt = text.replace(/:\s*NaN/gi, ': null');
      let data = parseFlexibleJSON(txt);
      
      if (!Array.isArray(data) || !data.length) {
        throw new Error('JSON dosyası boş veya geçersiz.');
      }

      data = addFullName(data);
      state.data = data;
      state.isLoading = false;
      
      buildFuse();
      buildFeaturedCollections();
      renderFeatured();

      const idx = Math.floor(Math.random() * data.length);
      const rnd = data[idx];
      setHeroFromPerfume(rnd);

      q('#criteria-section').style.display = 'none';
      const refOut = q('#refDetailOut');
      const meta = q('#resultsMeta');
      
      refOut.innerHTML = `
        <div class="empty-state">
          <h4>Koleksiyon Yüklendi</h4>
          <p>Bir parfüm arayabilir veya "Rastgele Parfüm" butonunu kullanabilirsiniz.</p>
        </div>`;
      meta.textContent = '';
      
      showToast(`${data.length} parfüm başarıyla yüklendi.`, 'ok');

      window.addEventListener('popstate', handleRealRouting);
      handleRealRouting();
      
    } catch (err) {
      log.error(err);
      state.isLoading = false;
      showToast(`Veri yüklenemedi: ${err.message}`, 'err');
      
      const refOut = q('#refDetailOut');
      refOut.innerHTML = `
        <div class="empty-state">
          <h4>Yükleme Başarısız</h4>
          <p>'perfumes_data.json' dosyası bulunamadı veya hatalı. Lütfen konsolu kontrol edin.</p>
        </div>`;
    }
  }

  // Event handlers
  function wireEvents() {
    // Brand logo - reset to home
    const brand = q('.brand');
    const brandClickHandler = () => resetToHome();
    on(brand, 'click', brandClickHandler);
    on(brand, 'keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        brandClickHandler();
      }
    });

    // Preferences toggles
    qa('#prefs .pref-row').forEach(row => {
      const togglePref = (e) => {
        if (e.target.closest('.tooltip-trigger')) return;
        
        row.classList.toggle('active');
        const toggle = row.querySelector('.toggle');
        if (toggle) toggle.classList.toggle('active');
        
        const isActive = row.classList.contains('active');
        row.setAttribute('aria-checked', isActive);
        
        findSimilar(false);
      };
      
      on(row, 'click', togglePref);
      on(row, 'keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          togglePref(e);
        }
      });
    });

    // Search functionality
    const input = q('#searchInput');
    const btn = q('#searchBtn');
    const suggest = q('#suggestions');
    let debounceTimer = null;

    on(input, 'input', () => {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        const qv = input.value.trim();
        
        if (!qv || !state.fuse) {
          suggest.classList.remove('show');
          input.setAttribute('aria-expanded', 'false');
          return;
        }

        const res = state.fuse.search(qv).slice(0, 8);
        
        if (!res.length) {
          suggest.classList.remove('show');
          input.setAttribute('aria-expanded', 'false');
          return;
        }

        suggest.innerHTML = res.map((r, idx) => {
          const it = r.item;
          const t = it['Image URL'] || `https://placehold.co/40x40/e2e8f0/64748b?text=${encodeURIComponent((it.Brand || '?').slice(0, 1))}`;
          const yr = it['Release Year'] != null && it['Release Year'] !== '' ? String(it['Release Year']) : '';
          const right = (it.Brand || yr) ? `(${[it.Brand, yr].filter(Boolean).join(', ')})` : '';
          
          return `<div class='s-item' data-index='${r.refIndex}' role="option" tabindex="0" aria-selected="false">
            <img class='s-thumb' src='${t}' alt='' loading='lazy' onerror="this.onerror=null;this.src='https://placehold.co/40x40/e2e8f0/64748b?text=?'"/>
            <div class='s-name'>${it.fullName}</div>
            <div class='s-brand'>${right}</div>
          </div>`;
        }).join('');
        
        suggest.classList.add('show');
        input.setAttribute('aria-expanded', 'true');
        
        // Add keyboard navigation for suggestions
        qa('.s-item', suggest).forEach((item, idx) => {
          on(item, 'keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              item.click();
            } else if (e.key === 'ArrowDown') {
              e.preventDefault();
              const next = qa('.s-item', suggest)[idx + 1];
              if (next) next.focus();
            } else if (e.key === 'ArrowUp') {
              e.preventDefault();
              const prev = qa('.s-item', suggest)[idx - 1];
              if (prev) prev.focus();
              else input.focus();
            }
          });
        });
      }, 200);
    });

    on(suggest, 'click', e => {
      const el = e.target.closest('.s-item');
      if (!el) return;
      
      const idx = parseInt(el.dataset.index, 10);
      if (!isNaN(idx) && state.data[idx]) {
        setReferenceAndFindSimilar(state.data[idx], true);
      }
      
      suggest.classList.remove('show');
      input.setAttribute('aria-expanded', 'false');
    });

    on(document, 'click', e => {
      if (!suggest.contains(e.target) && e.target !== input) {
        suggest.classList.remove('show');
        input.setAttribute('aria-expanded', 'false');
      }
    });

    on(input, 'keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
        suggest.classList.remove('show');
        input.setAttribute('aria-expanded', 'false');
        findSimilar();
      } else if (e.key === 'Escape') {
        suggest.classList.remove('show');
        input.setAttribute('aria-expanded', 'false');
      } else if (e.key === 'ArrowDown') {
        e.preventDefault();
        const firstItem = q('.s-item', suggest);
        if (firstItem) firstItem.focus();
      }
    });

    on(btn, 'click', () => {
      suggest.classList.remove('show');
      input.setAttribute('aria-expanded', 'false');
      findSimilar();
    });

    // Delegated event handlers for dynamic links
    const linkHandlers = {
      '.perfumer-link': (el) => {
        const name = decodeURIComponent(el.dataset.perfumer);
        showPerfumerResults(name);
      },
      '.brand-link': (el) => {
        const name = decodeURIComponent(el.dataset.brand);
        showBrandResults(name);
      },
      '.accord-link': (el) => {
        const accord = decodeURIComponent(el.dataset.accord);
        showAccordResults(accord);
      },
      '.note-link': (el) => {
        const note = decodeURIComponent(el.dataset.note);
        showNoteResults(note);
      },
    };

    on(q('#appRoot'), 'click', e => {
      for (const selector in linkHandlers) {
        const link = e.target.closest(selector);
        if (link && link.dataset) {
          e.preventDefault();
          e.stopPropagation();
          linkHandlers[selector](link);
          return;
        }
      }
    });

    // Keyboard navigation for links
    on(q('#appRoot'), 'keydown', e => {
      if (e.key !== 'Enter' && e.key !== ' ') return;
      
      for (const selector in linkHandlers) {
        const link = e.target.closest(selector);
        if (link && link.dataset) {
          e.preventDefault();
          e.stopPropagation();
          linkHandlers[selector](link);
          return;
        }
      }
    });

    // Surprise button
    const surpriseBtn = q('#surpriseBtn');
    on(surpriseBtn, 'click', handleSurprise);

    // Sign up button
    on(q('#signupBtn'), 'click', () => showToast('Yakında!', 'info'));

    // FAB scroll to top
    const fab = q('#fabTop');
    const toggleFab = () => {
      if (window.scrollY > 280) {
        fab.classList.add('show');
      } else {
        fab.classList.remove('show');
      }
    };
    
    on(window, 'scroll', toggleFab, { passive: true });
    toggleFab();
    
    on(fab, 'click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      // Focus on skip link after scroll
      setTimeout(() => {
        const skipLink = q('.skip-link');
        if (skipLink) skipLink.focus();
      }, 500);
    });
  }

  // Public API
  window.simscent = {
    getState: () => ({
      count: state.data.length,
      hasFuse: !!state.fuse,
      currentRef: state.currentRef,
      featured: state.featured,
      isLoading: state.isLoading
    }),
    loadJSON: (txt) => {
      const data = addFullName(parseFlexibleJSON(txt));
      state.data = data;
      buildFuse();
      buildFeaturedCollections();
      renderFeatured();
      log.info('Manual load', data.length);
    },
    search: (query) => {
      q('#searchInput').value = query;
      findSimilar(true);
    }
  };

  // Initialize
  function init() {
    log.info('Initializing simscent...');
    wireEvents();
    loadInitialData();
  }

  // Start the app
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>
</body>
</html>
