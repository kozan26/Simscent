<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>simscent — Ana Sayfa</title>
    <meta name="description" content="Benzersiz tercihlerinle eşleşen parfümleri keşfet. Hazır koleksiyonumuzu incele ve sana en uygun eşleşmeyi bul." />
    <meta name="google-adsense-account" content="ca-pub-9033780165680589">
    <link rel="canonical" href="https://www.simscent.com/" />

    <!-- Favicon / App Icons -->
    <link rel="icon" href="/assets/logo.svg" type="image/svg+xml">
    <link rel="alternate icon" href="/assets/favicon-32.png" sizes="32x32" type="image/png">

    <!-- Google Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet" />
    
    <!-- Fuse.js for fuzzy search -->
    <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7LCE4Z60ZB"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-7LCE4Z60ZB');
    </script>

    <style>
        /* --- Base Styles & Variables --- */
        :root {
            --brand-primary: #B99B6B;
            --brand-secondary: #A08C62;
            --text-primary: #3a3a3a;
            --text-muted: #888;
            --border-color: #eee;
            --card-bg: #fff;
            --shell-bg: #f9f8f6;
            --elevation-1: 0 4px 15px rgba(0, 0, 0, .05);
            --elevation-2: 0 8px 30px rgba(0, 0, 0, .07);
            --elevation-3: 0 12px 40px rgba(0, 0, 0, .1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Ubuntu, 'Helvetica Neue', Arial, sans-serif;
            color: var(--text-primary);
            line-height: 1.6;
            background: var(--shell-bg);
        }

        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background-image: radial-gradient(hsla(0, 0%, 82%, .2) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: .35;
            pointer-events: none;
            z-index: -1;
        }

        /* --- Layout & Card --- */
        .container {
            max-width: 1200px;
            margin: 28px auto;
            padding: 16px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            box-shadow: var(--elevation-2);
            overflow: hidden;
            position: relative;
        }

        .card__inner {
            padding: 24px 16px;
        }

        .section {
            padding: 32px 0;
            border-top: 1px dashed #e5e7eb;
        }
        
        /* --- Header & Brand --- */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 12px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 800;
            font-size: 22px;
            letter-spacing: -.02em;
            font-family: 'Playfair Display', serif;
            cursor: pointer;
            text-decoration: none;
            color: var(--text-primary);
        }

        .brand__logo {
            width: 32px;
            height: 32px;
        }

        /* --- Buttons --- */
        .btn {
            border: none;
            border-radius: 8px;
            padding: 14px 22px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            transition: all .2s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn--primary {
            background: var(--text-primary);
            color: #fff;
        }
        .btn--primary:hover {
            background: #000;
        }

        .btn--ghost {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        .btn--ghost:hover {
            border-color: #ccc;
            background: #fafafa;
        }
        
        .btn--cta {
            padding: 10px 20px;
        }

        /* --- Hero Section --- */
        .hero {
            display: grid;
            grid-template-columns: 1fr;
            gap: 40px;
            align-items: center;
            margin-top: 20px;
        }

        .hero__shot-wrap {
            position: relative;
        }

        .hero__shot {
            width: 100%;
            aspect-ratio: 1/1;
            object-fit: cover;
            padding: 16px;
            background: #fff;
            border: 1px solid var(--border-color);
            border-radius: 28px;
            transform: rotate(-6deg);
            box-shadow: 0 28px 70px rgba(0, 0, 0, .15);
        }
        
        .hero__blob {
            position: absolute;
            border-radius: 28px;
            width: 120px;
            height: 120px;
            background: rgba(185, 155, 107, .15);
            left: -18px;
            top: -16px;
            opacity: .8;
        }
        
        .hero__blob--secondary {
            width: 130px;
            height: 130px;
            background: rgba(185, 155, 107, .1);
            left: 220px;
            bottom: -10px;
            opacity: .6;
        }

        .hero__title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(38px, 5.6vw, 60px);
            font-weight: 800;
            letter-spacing: -.04em;
            line-height: 1.05;
            color: #222;
            margin-bottom: 16px;
        }

        .hero__desc {
            color: var(--text-muted);
            max-width: 760px;
            font-size: 17px;
        }

        .hero__actions {
            display: flex;
            flex-wrap: wrap;
            gap: 14px;
            margin-top: 20px;
        }

        /* --- Search Bar & Suggestions --- */
        .search {
            margin: 28px 0 12px;
            max-width: 760px;
            position: relative;
            z-index: 60;
        }
        
        .search__bar {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 999px;
            padding: 12px 16px;
            box-shadow: var(--elevation-1);
        }

        .search__input {
            flex: 1;
            border: none;
            background: transparent;
            outline: none;
            font-size: 16px;
            color: var(--text-primary);
            caret-color: var(--text-primary);
        }
        
        .search__input::placeholder {
            color: #aaa;
        }

        .search__btn {
            width: 44px;
            height: 44px;
            border-radius: 999px;
            border: none;
            display: grid;
            place-items: center;
            background: var(--text-primary);
            color: #fff;
            cursor: pointer;
        }

        .search-suggestions {
            display: none;
            position: absolute;
            left: 0;
            right: 0;
            top: 100%;
            margin-top: 12px;
            background: #fff;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            box-shadow: var(--elevation-2);
            max-height: 320px;
            overflow: auto;
            text-align: left;
            z-index: 70;
        }
        
        .suggestion-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
        }

        .suggestion-item:hover {
            background-color: var(--shell-bg);
        }

        .suggestion-item__thumb {
            width: 34px;
            height: 34px;
            border-radius: 9px;
            object-fit: cover;
            background: #e2e8f0;
            flex-shrink: 0;
        }

        .suggestion-item__name {
            font-weight: 700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .suggestion-item__brand {
            color: var(--text-muted);
            font-size: 13px;
            margin-left: auto;
            white-space: nowrap;
        }
        
        /* --- Preferences Section --- */
        .preferences__grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px 16px;
        }
        
        .preferences__row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 12px;
            min-height: 48px;
            border: 1px solid #f1f5f9;
            border-radius: 14px;
            background: #fff;
            cursor: pointer;
        }
        
        .preferences__label {
            font-size: 16px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .toggle-switch {
            position: relative;
            width: 44px;
            height: 26px;
            background: #e2e8f0;
            border-radius: 999px;
            transition: background .25s ease;
            cursor: pointer;
            flex-shrink: 0;
        }

        .toggle-switch__dot {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            border-radius: 999px;
            background: #fff;
            box-shadow: 0 2px 6px rgba(2, 6, 23, .15);
            transition: transform .25s ease;
        }
        
        .toggle-switch.is-active {
            background: var(--brand-primary);
        }

        .toggle-switch.is-active .toggle-switch__dot {
            transform: translateX(18px);
        }

        /* --- Featured Section --- */
        .section-title {
            font-weight: 800;
            font-size: 22px;
            margin-bottom: 16px;
            font-family: 'Playfair Display', serif;
        }
        
        .featured__grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 18px;
        }

        .featured-card {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 14px;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            background: #fff;
            box-shadow: var(--elevation-1);
            cursor: pointer;
            transition: all .2s;
        }
        
        .featured-card:hover {
            box-shadow: var(--elevation-3);
            transform: translateY(-2px);
        }
        
        .featured-card__head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .featured-card__title {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            font-weight: 800;
            color: #222;
        }

        .featured-card__sub {
            color: var(--text-muted);
            font-size: 13px;
        }

        .featured-card__body {
            display: grid;
            grid-template-columns: 72px 1fr;
            gap: 12px;
            align-items: center;
        }

        .featured-card__img {
            width: 72px;
            height: 72px;
            border-radius: 12px;
            object-fit: cover;
            background: #e2e8f0;
        }
        
        /* --- Results & Perfume Cards --- */
        .perfume-card {
            display: flex;
            flex-direction: column;
            gap: 12px;
            border-radius: 18px;
            padding: 12px;
            border: 1px solid transparent;
            box-shadow: var(--elevation-1);
            background: #fff;
            transition: box-shadow .28s, transform .28s, border-color .28s;
            overflow: hidden;
        }
        
        .perfume-card:hover {
            transform: translate3d(0, -6px, 0);
            box-shadow: var(--elevation-3);
            border-color: rgba(185, 155, 107, .35);
        }
        
        .perfume-card__img {
            width: 100%;
            aspect-ratio: 1/1;
            border-radius: 12px;
            object-fit: cover;
            background: #e2e8f0;
            margin: 0;
        }
        
        .perfume-card__brand {
            font-size: 12px;
            letter-spacing: .4px;
            text-transform: uppercase;
            color: var(--brand-primary);
            font-weight: 700;
        }
        
        .perfume-card__name {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            line-height: 1.25;
            font-weight: 700;
        }
        
        .badge {
            background: var(--brand-primary);
            color: #fff;
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 700;
            margin-left: auto;
            white-space: nowrap;
        }
        
        .chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--border-color);
            background: var(--shell-bg);
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 13px;
            font-weight: 600;
        }

        .chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .data-link {
            font-weight: 600;
            color: var(--brand-secondary);
            transition: color .2s;
            cursor: pointer;
        }
        
        .data-link:hover {
            color: var(--brand-primary);
            text-decoration: underline;
        }
        
        .chip.data-link:hover {
            background-color: #e2e8f0;
            border-color: #d1d5db;
            color: var(--text-primary);
        }
        
        /* --- Reference Detail Card --- */
        .ref-card__grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 28px;
            align-items: start;
        }

        .ref-card__image {
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            aspect-ratio: 1/1;
            border-radius: 20px;
            object-fit: cover;
        }

        .ref-card__title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(26px, 4vw, 34px);
            font-weight: 700;
            line-height: 1.2;
            color: #222;
            margin: 0;
        }

        .ref-card__sub {
            color: var(--text-muted);
            font-size: 15px;
            margin-top: 8px;
            margin-bottom: 28px;
        }
        
        .detail-section {
            padding-top: 20px;
            margin-top: 20px;
            border-top: 1px solid var(--shell-bg);
        }
        
        .detail-section:first-of-type {
            margin-top: 0;
            padding-top: 0;
            border-top: 0;
        }

        .detail-section__title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: .8px;
            opacity: .8;
        }
        
        /* --- Score Rings --- */
        .scores {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 18px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }
        
        .score-item__ring {
            position: relative;
            width: 54px;
            height: 54px;
            margin: 0 auto 6px;
        }
        
        .score-item__svg {
            width: 54px;
            height: 54px;
            transform: rotate(-90deg);
        }
        
        .score-item__bg {
            fill: none;
            stroke: #eef2f7;
  *         stroke-width: 6;
        }

        .score-item__fg {
            fill: none;
            stroke: var(--brand-primary);
            stroke-width: 6;
            stroke-linecap: round;
            transition: stroke-dashoffset .6s;
        }

        .score-item__val {
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            font-weight: 800;
            font-size: 13px;
        }
        
        /* --- Carousel --- */
        .carousel-container {
            position: relative;
        }

        .carousel__window {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            padding-bottom: 16px;
        }
        
        .carousel__window::-webkit-scrollbar {
            display: none;
        }

        .carousel__window > .perfume-card {
            flex: 0 0 70%;
            scroll-snap-align: start;
            margin: 10px 16px 10px 0;
        }

        .carousel__btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255, 255, 255, .9);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, .1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            transition: all .2s;
        }

        .carousel__btn:hover {
            background: #fff;
            box-shadow: 0 6px 16px rgba(0, 0, 0, .12);
            transform: translateY(-50%) scale(1.05);
        }

        .carousel__btn:disabled {
            opacity: .3;
            cursor: not-allowed;
            transform: translateY(-50%);
        }

        .carousel__btn--prev { left: -22px; }
        .carousel__btn--next { right: -22px; }
        
        /* --- Utility & Floating Elements --- */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translate(-50%, 16px);
            background: var(--text-primary);
            color: #fff;
            padding: 12px 18px;
            border-radius: 12px;
            box-shadow: var(--elevation-2);
            opacity: 0;
            pointer-events: none;
            transition: opacity .25s, transform .25s;
            z-index: 9999;
            font-weight: 700;
            font-size: 15px;
            letter-spacing: .2px;
        }

        .toast.is-visible {
            opacity: 1;
            transform: translate(-50%, 0);
        }

        .toast--error { background: linear-gradient(135deg, #ef4444, #b91c1c); }
        .toast--info { background: linear-gradient(135deg, #64748b, #334155); }

        .fab {
            position: fixed;
            right: 24px;
            bottom: 24px;
            width: 56px;
            height: 56px;
            border: none;
            border-radius: 999px;
            display: grid;
            place-items: center;
            color: #fff;
            background: var(--text-primary);
            box-shadow: var(--elevation-3);
            cursor: pointer;
            opacity: 0;
            transform: translateY(12px) scale(.96);
            pointer-events: none;
            transition: opacity .25s, transform .25s;
            z-index: 9998;
        }
        
        .fab.is-visible {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }
        
        /* --- Tooltip --- */
        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            min-width: 200px;
            max-width: 260px;
            background-color: var(--text-primary);
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            line-height: 1.4;
            text-align: center;
            white-space: normal;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity .2s, visibility .2s;
            z-index: 100;
            box-shadow: var(--elevation-2);
        }
        
        [data-tooltip]:hover::after {
            opacity: 1;
            visibility: visible;
        }


        /* --- Media Queries --- */
        @media(min-width: 480px) {
            .scores { grid-template-columns: repeat(4, 1fr); }
        }
        @media(min-width: 640px) {
            .carousel__window > .perfume-card { flex-basis: calc(40% - 12px); margin-right: 24px; }
            .featured__grid { grid-template-columns: repeat(3, 1fr); }
        }
        @media(min-width: 768px) {
            .container { padding: 28px; }
            .card__inner { padding: 32px; }
            .section { padding: 48px 0; }
            .preferences__label { font-size: 18px; }
            .carousel__btn--prev { left: -10px; }
            .carousel__btn--next { right: -10px; }
        }
        @media(min-width: 920px) {
            .ref-card__grid { grid-template-columns: 300px 1fr; gap: 40px; }
        }
        @media(min-width: 980px) {
            .hero { grid-template-columns: 420px 1fr; gap: 60px; }
        }
        @media(min-width: 1024px) {
            .card__inner { padding: 40px; }
            .carousel__window > .perfume-card { flex-basis: calc(25% - 18px); }
        }
        @media(min-width: 1400px) {
            .carousel__window > .perfume-card { flex-basis: calc(20% - 19.2px); }
        }
    </style>
</head>
<body>
    <main class="container" id="appRoot">
        <div class="card">
            <div class="card__inner">
                <header class="header">
                    <a href="/" class="brand" id="brandLink">
                        <img class="brand__logo" src="/assets/logo.svg" alt="simscent logo" width="32" height="32">
                        simscent
                    </a>
                    <button class="btn btn--primary btn--cta" id="signupBtn">Kayıt Ol</button>
                </header>

                <section id="hero" class="hero">
                    <div class="hero__shot-wrap">
                        <div class="hero__blob"></div>
                        <img id="heroShot" class="hero__shot" src="https://images.unsplash.com/photo-1617839400561-d55457a29da2?q=80&w=930&auto=format&fit=crop" alt="parfüm şişesi" />
                        <div class="hero__blob hero__blob--secondary"></div>
                    </div>
                    <div>
                        <h1 class="hero__title">İmza Kokunu<br />Keşfet</h1>
                        <p class="hero__desc">Benzersiz tercihlerinle eşleşen parfümleri keşfet. Hazır koleksiyonumuzu incele ve sana en uygun eşleşmeyi bul.</p>
                        <div class="search">
                            <div class="search__bar">
                                <input id="searchInput" class="search__input" type="text" placeholder="Bir parfüm ara, örn: 'Aventus'" autocomplete="off" aria-label="Parfüm ara" />
                                <button id="searchBtn" class="search__btn" title="Ara" aria-label="Ara">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
                                </button>
                            </div>
                            <div id="suggestions" class="search-suggestions" role="listbox" aria-label="Öneriler"></div>
                        </div>
                        <div class="hero__actions">
                            <a class="btn btn--primary" href="#results">Koleksiyonu Keşfet</a>
                            <button class="btn btn--ghost" id="surpriseBtn" type="button">Beni Şaşırt!</button>
                        </div>
                    </div>
                </section>

                <section class="section" id="preferencesSection" style="display:none">
                    <h3 class="section-title">Tercihler</h3>
                    <div class="card" style="box-shadow:none;border:1px solid var(--border-color);padding:16px; overflow: visible;">
                        <h4 class="section-title" style="font-size:18px;">Benzerlik Ağırlıkları</h4>
                        <div id="preferencesGrid" class="preferences__grid">
                            <div class="preferences__row" data-tooltip="Parfümün kullanım amacını (günlük, iş, akşam vb.) ne kadar dikkate alacağını belirler."><span class="preferences__label">Kullanım Amacı</span><div class="toggle-switch is-active" data-pref="usage"><div class="toggle-switch__dot"></div></div></div>
                            <div class="preferences__row" data-tooltip="Parfümün uygun olduğu mevsimi (ilkbahar, yaz, sonbahar, kış) ne kadar dikkate alacağını belirler."><span class="preferences__label">Mevsim</span><div class="toggle-switch is-active" data-pref="season"><div class="toggle-switch__dot"></div></div></div>
                            <div class="preferences__row" data-tooltip="Parfümün stilini (klasik, modern, maskülen, feminen) ne kadar dikkate alacağını belirler."><span class="preferences__label">Stil</span><div class="toggle-switch is-active" data-pref="style"><div class="toggle-switch__dot"></div></div></div>
                            <div class="preferences__row" data-tooltip="Parfümün ait olduğu koku ailesini (odunsu, narenciye, çiçeksi vb.) ne kadar dikkate alacağını belirler."><span class="preferences__label">Koku Ailesi</span><div class="toggle-switch is-active" data-pref="family"><div class="toggle-switch__dot"></div></div></div>
                        </div>
                    </div>
                </section>

                <section class="section" id="featuredSection" style="display:none">
                    <h3 class="section-title">Öne Çıkan Koleksiyonlar</h3>
                    <div class="carousel-container" style="position: relative;">
                        <div id="featuredGrid" class="featured__grid"></div>
                        <button id="featPrev" class="carousel__btn carousel__btn--prev" aria-label="Önceki" style="display: none;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                        <button id="featNext" class="carousel__btn carousel__btn--next" aria-label="Sonraki" style="display: none;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg></button>
                    </div>
                </section>

                <section class="section" id="results">
                    <h3 class="section-title">Sonuçlar</h3>
                    <div id="resultsOutput">
                        <div style="text-align:center;padding:40px 20px;background:var(--shell-bg);border-radius:16px">
                            <h4 style="font-weight:700;font-size:18px;font-family:'Playfair Display',serif">Keşfetmeye Başla</h4>
                            <p style="color:var(--text-muted);margin-top:4px">Başlamak için yukarıdan bir parfüm arayın veya “Beni Şaşırt!” butonunu kullanın.</p>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>
    <button id="fabTop" class="fab" aria-label="Yukarı kaydır" title="Yukarı">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5l0 14M5.5 11.5L12 5l6.5 6.5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
    </button>
<script>
'use strict';
document.addEventListener('DOMContentLoaded', () => {

    // --- UTILITIES & HELPERS ---
    const $ = (selector, context = document) => context.querySelector(selector);
    const $$ = (selector, context = document) => Array.from(context.querySelectorAll(selector));
    
    // Simple logger that respects a DEBUG flag
    const DEBUG = window.location.search.includes('debug');
    const log = (...args) => DEBUG && console.log('%c[simscent]', 'color:#6366f1;font-weight:700', ...args);

    const showToast = (message, type = 'ok') => {
        const toastEl = $('#toast');
        if (!toastEl) return log(`[Toast] ${message}`);
        
        toastEl.textContent = message;
        toastEl.className = `toast toast--${type} is-visible`;
        
        clearTimeout(window.__toastTimer);
        window.__toastTimer = setTimeout(() => {
            toastEl.classList.remove('is-visible');
        }, 2800);
    };
    
    // --- STATE MANAGEMENT ---
    const state = {
        perfumes: [],
        fuse: null,
        currentReference: null,
        featured: {
            pairs: [],
            topMap: new Map(),
            page: 0
        }
    };

    // --- CONSTANTS & CONFIGURATION ---
    const DATA_URL = '/perfumes_data.json';
    const CONSTANTS = {
        KEYS: {
            usage: ['Daily', 'Business', 'Evening', 'Night Out', 'Leisure', 'Sport'],
            season: ['Spring', 'Summer', 'Fall', 'Winter'],
            style: ['Classic', 'Masculine', 'Feminine', 'Modern'],
            family: ['Animal','Aquatic','Chypre','Citrus','Creamy','Earthy','Floral','Fougère','Fresh','Fruity','Gourmand','Green','Leathery','Oriental','Powdery','Resinous','Smoky','Spicy','Sweet','Synthetic','Woody']
        },
        LABELS: {Daily:'Günlük',Business:'İş',Evening:'Akşam','Night Out':'Gece',Leisure:'Rahat',Sport:'Spor',Spring:'İlkbahar',Summer:'Yaz',Fall:'Sonbahar',Winter:'Kış',Classic:'Klasik',Masculine:'Maskülen',Feminine:'Feminen',Modern:'Modern'},
        ACCORD_TR: {'woody':'Odunsu','aromatic':'Aromatik','fresh spicy':'Taze Baharatlı','citrus':'Narenciye','amber':'Amber','warm spicy':'Sıcak Baharatlı','green':'Yeşil','sweet':'Tatlı','musky':'Misk','fruity':'Meyvemsi','powdery':'Pudramsı','vanilla':'Vanilya','floral':'Çiçeksi','white floral':'Beyaz Çiçeksi','rose':'Gül','oud':'Öd','smoky':'Dumanlı','leather':'Deri','earthy':'Topraksı','animalic':'Hayvansı','aquatic':'Akvatik','patchouli':'Paçuli','iris':'İris','balsamic':'Balsamik','tobacco':'Tütün','cinnamon':'Tarçın','spicy':'Baharatlı','resinous':'Reçineli','chypre':'Şipre','fougère':'Fujer','gourmand':'Gurme','creamy':'Kremamsı','synthetic':'Sentetik','fresh':'Ferah'},
        FAMILY_TR: {Animal:'Hayvansı',Aquatic:'Akvatik',Chypre:'Şipre',Citrus:'Narenciye',Creamy:'Kremamsı',Earthy:'Topraksı',Floral:'Çiçeksi','Fougère':'Fujer',Fresh:'Ferahlık',Fruity:'Meyvemsi',Gourmand:'Gurme',Green:'Yeşil',Leathery:'Deri',Oriental:'Oryantal',Powdery:'Pudramsı',Resinous:'Reçineli',Smoky:'Dumanlı',Spicy:'Baharatlı',Sweet:'Tatlı',Synthetic:'Sentetik',Woody:'Odunsu'}
    };

    // --- DOM ELEMENTS ---
    const DOM = {
        appRoot: $('#appRoot'),
        searchInput: $('#searchInput'),
        searchBtn: $('#searchBtn'),
        suggestions: $('#suggestions'),
        resultsOutput: $('#resultsOutput'),
        preferencesSection: $('#preferencesSection'),
        featuredSection: $('#featuredSection'),
        featuredGrid: $('#featuredGrid'),
        featPrev: $('#featPrev'),
        featNext: $('#featNext'),
        fabTop: $('#fabTop'),
        heroShot: $('#heroShot')
    };

    // --- DATA HANDLING & LOGIC ---
    const DataService = {
        async loadPerfumes() {
            try {
                const response = await fetch(DATA_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const rawText = await response.text();
                // Replace NaN with null for valid JSON parsing
                const cleanText = rawText.replace(/:\s*NaN/gi, ': null');
                let data = JSON.parse(cleanText);

                if(data && typeof data === 'object' && !Array.isArray(data)) {
                    data = data.data || data.items || [];
                }

                if (!Array.isArray(data) || data.length === 0) {
                    throw new Error('No valid perfume data found in JSON.');
                }
                
                state.perfumes = this.preprocessData(data);
                this.buildSearchIndex();
                this.buildFeaturedIndex();
                
                log(`${state.perfumes.length} perfumes loaded successfully.`);
                return true;
            } catch (error) {
                console.error("Failed to load perfume data:", error);
                showToast(`Veri yüklenemedi: ${error.message}`, 'error');
                return false;
            }
        },

        preprocessData(data) {
            return data.map(p => {
                const name = p['Fragrance Name'] || p.name || '';
                const conc = p.Concentration || p.concentration || '';
                p.fullName = (conc ? `${name} ${conc}` : name).trim();
                return p;
            });
        },

        buildSearchIndex() {
            if (!state.perfumes.length) return;
            state.fuse = new Fuse(state.perfumes, {
                includeScore: true,
                threshold: 0.38,
                keys: [
                    { name: 'fullName', weight: 0.7 },
                    { name: 'Brand', weight: 0.3 }
                ]
            });
        },

        buildFeaturedIndex() {
            const usedFamilyKeys = (data) => CONSTANTS.KEYS.family.filter(k => data.some(p => Number(p[k] || 0) > 0));
            const cosine = (v1, v2) => {
                let dot = 0, n1 = 0, n2 = 0;
                const L = Math.min(v1.length, v2.length);
                for (let i = 0; i < L; i++) {
                    const a = +v1[i] || 0, b = +v2[i] || 0;
                    dot += a * b;
                    n1 += a * a;
                    n2 += b * b;
                }
                return (!n1 || !n2) ? 0 : dot / (Math.sqrt(n1) * Math.sqrt(n2));
            };

            const cats = usedFamilyKeys(state.perfumes);
            const N = state.perfumes.length;
            if (!N || cats.length < 2) {
                state.featured = { pairs: [], topMap: new Map(), page: 0 };
                return;
            }

            const vectors = new Map();
            for (const c of cats) {
                const arr = new Array(N);
                for (let i = 0; i < N; i++) arr[i] = Number(state.perfumes[i][c] || 0) || 0;
                vectors.set(c, arr);
            }

            const allPairs = [];
            for (let i = 0; i < cats.length; i++) {
                for (let j = i + 1; j < cats.length; j++) {
                    const a = cats[i], b = cats[j];
                    const sim = cosine(vectors.get(a), vectors.get(b));
                    allPairs.push({ a, b, sim });
                }
            }
            allPairs.sort((x, y) => y.sim - x.sim);

            let topPairs = allPairs.filter(p => isFinite(p.sim) && p.sim >= 0.35).slice(0, 10);
            if (topPairs.length < 3) topPairs = allPairs.filter(p => p.sim >= 0.20).slice(0, 10);
            if (topPairs.length < 3) topPairs = allPairs.slice(0, 10);

            const topMap = new Map();
            for (const { a, b } of topPairs) {
                let scored = state.perfumes.map((p, idx) => ({
                    idx,
                    perfume: p,
                    score: (+p[a] || 0) + (+p[b] || 0)
                }))
                .filter(x => x.score > 0)
                .sort((u, v) => v.score - u.score)
                .slice(0, 20);
                
                const key = `${a}|${b}`;
                topMap.set(key, scored);
            }
            state.featured = { pairs: topPairs, topMap, page: 0 };
            log('Featured index built.', state.featured.pairs.length, 'pairs found.');
        },
        
        search(query) {
            if (!state.fuse) return [];
            return state.fuse.search(query).slice(0, 8);
        },

        findSimilarities(target) {
            const getActivePrefs = () => $$('#preferencesGrid .toggle-switch.is-active')
                .map(el => el.dataset.pref)
                .reduce((acc, pref) => ({ ...acc, [pref]: true }), {});

            const prefs = getActivePrefs();
            const vecSim = (a, b, keys) => {
                let dot = 0, n1 = 0, n2 = 0;
                for (const k of keys) {
                    const x = Number(a[k] || 0);
                    const y = Number(b[k] || 0);
                    dot += x * y;
                    n1 += x * x;
                    n2 += y * y;
                }
                return (!n1 || !n2) ? 0 : dot / (Math.sqrt(n1) * Math.sqrt(n2));
            };

            return state.perfumes
                .map(p => {
                    if (p.fullName === target.fullName) return { perfume: p, similarity: -1 };
                    let totalSim = 0, weightCount = 0;
                    for (const key in prefs) {
                        if (prefs[key] && CONSTANTS.KEYS[key]) {
                            totalSim += vecSim(target, p, CONSTANTS.KEYS[key]);
                            weightCount++;
                        }
                    }
                    const avgSim = weightCount > 0 ? totalSim / weightCount : 0;
                    return { perfume: p, similarity: Math.pow(avgSim, 3) }; // Pow enhances contrast
                })
                .filter(item => item.similarity > -1)
                .sort((a, b) => b.similarity - a.similarity)
                .slice(0, 10);
        }
    };
    
    // --- UI RENDERING & TEMPLATES ---
    const UI = {
        // ... (This would contain all functions that create HTML strings or DOM elements)
        // For brevity, I'll keep the render functions inside the main controller for now.
    };

    // --- MAIN APPLICATION CONTROLLER ---
    const App = {
        init() {
            this.showLoadingState();
            DataService.loadPerfumes().then(success => {
                if (success) {
                    this.bindEvents();
                    this.showInitialState();
                    this.setRandomHeroPerfume();
                    this.pickAndRenderFeatured();
                } else {
                    this.showErrorState();
                }
            });
        },

        bindEvents() {
            // Search functionality
            let searchTimeout;
            DOM.searchInput.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => this.handleSearchInput(), 150);
            });
            DOM.searchInput.addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    this.handleSearchSubmit();
                }
            });
            DOM.searchBtn.addEventListener('click', () => this.handleSearchSubmit());
            DOM.suggestions.addEventListener('click', e => this.handleSuggestionClick(e));
            document.addEventListener('click', e => {
                if (!DOM.suggestions.contains(e.target) && e.target !== DOM.searchInput) {
                    DOM.suggestions.style.display = 'none';
                }
            });

            // Preferences toggles
            $$('#preferencesGrid .preferences__row').forEach(row => {
                row.addEventListener('click', (e) => this.handlePrefToggle(e));
            });
            
            // Other actions
            $('#surpriseBtn').addEventListener('click', () => this.handleSurprise());
            $('#brandLink').addEventListener('click', (e) => { e.preventDefault(); this.resetToHome(); });
            DOM.featPrev.addEventListener('click', () => this.navigateFeatured(-1));
            DOM.featNext.addEventListener('click', () => this.navigateFeatured(1));
            
            // FAB scroll-to-top
            const toggleFab = () => DOM.fabTop.classList.toggle('is-visible', window.scrollY > 280);
            window.addEventListener('scroll', toggleFab, { passive: true });
            DOM.fabTop.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
        },
        
        // Event Handlers
        handleSearchInput() {
            const query = DOM.searchInput.value.trim();
            if (!query) {
                DOM.suggestions.style.display = 'none';
                return;
            }
            const results = DataService.search(query);
            this.renderSuggestions(results);
        },

        handleSearchSubmit() {
            DOM.suggestions.style.display = 'none';
            const query = DOM.searchInput.value.trim();
            if (!query) {
                showToast('Lütfen bir parfüm adı girin.', 'info');
                return;
            }
            const results = DataService.search(query);
            if (results.length > 0) {
                this.setReferenceAndFindSimilar(results[0].item);
            } else {
                showToast('Parfüm bulunamadı. Lütfen tekrar deneyin.', 'error');
            }
        },
        
        handleSuggestionClick(event) {
            const target = event.target.closest('.suggestion-item');
            if (target && target.dataset.index) {
                const index = parseInt(target.dataset.index, 10);
                const perfume = state.perfumes[index];
                if (perfume) {
                    this.setReferenceAndFindSimilar(perfume);
                    DOM.suggestions.style.display = 'none';
                }
            }
        },

        handlePrefToggle(event) {
            const row = event.target.closest('.preferences__row');
            const toggle = row.querySelector('.toggle-switch');
            if (toggle) {
                toggle.classList.toggle('is-active');
                if (state.currentReference) {
                    // Re-calculate similarities with new preferences
                    const similar = DataService.findSimilarities(state.currentReference);
                    this.renderResults(state.currentReference, similar);
                }
            }
        },

        handleSurprise() {
            if (state.perfumes.length > 0) {
                const randomIndex = Math.floor(Math.random() * state.perfumes.length);
                const perfume = state.perfumes[randomIndex];
                this.setRandomHeroPerfume(perfume);
                this.setReferenceAndFindSimilar(perfume);
            }
        },
        
        pickAndRenderFeatured(count = 3) {
            const { pairs, topMap, page } = state.featured;
            const grid = DOM.featuredGrid;
            grid.innerHTML = '';
            
            if (!pairs || pairs.length === 0) {
                DOM.featuredSection.style.display = 'none';
                return;
            }
            
            DOM.featuredSection.style.display = 'block';

            const pool = pairs.slice(0, 10);
            const start = (page * count) % pool.length;
            const chosenPairs = [];
            for (let i = 0; i < count; i++) chosenPairs.push(pool[(start + i) % pool.length]);

            let hasContent = false;
            for (const pair of chosenPairs) {
                const key = `${pair.a}|${pair.b}`;
                const items = topMap.get(key) || [];
                const len = Math.min(items.length, 20);
                
                if (len === 0) continue;

                hasContent = true;
                const choice = items[Math.floor(Math.random() * len)];
                const perf = choice.perfume;
                
                const img = perf['Image URL'] || `https://placehold.co/144x144/e2e8f0/64748b?text=${encodeURIComponent(perf.Brand?.[0] || '?')}`;
                const title = `${CONSTANTS.FAMILY_TR[pair.a] || pair.a} & ${CONSTANTS.FAMILY_TR[pair.b] || pair.b}`;

                const cardEl = document.createElement('div');
                cardEl.className = 'featured-card';
                cardEl.innerHTML = `
                    <div class="featured-card__head">
                        <div>
                            <div class="featured-card__title">${title}</div>
                            <div class="featured-card__sub">Bu ikilinin seçkisinden</div>
                        </div>
                    </div>
                    <div class="featured-card__body">
                        <img class="featured-card__img" src="${img}" alt="${perf.fullName}"/>
                        <div>
                            <div class="perfume-card__brand">${perf.Brand || ''}</div>
                            <div class="perfume-card__name">${perf.fullName}</div>
                        </div>
                    </div>
                `;
                cardEl.addEventListener('click', () => this.setReferenceAndFindSimilar(perf));
                grid.appendChild(cardEl);
            }

            const showButtons = hasContent && pool.length > count;
            DOM.featPrev.style.display = DOM.featNext.style.display = showButtons ? 'flex' : 'none';
        },
        
        navigateFeatured(direction) {
            const { pairs } = state.featured;
            const count = 3;
            const pages = Math.ceil(Math.min(pairs.length, 10) / count);
            state.featured.page = (state.featured.page + direction + pages) % pages;
            this.pickAndRenderFeatured(count);
        },
        
        // State Changers & Renders
        showLoadingState() {
            DOM.resultsOutput.innerHTML = `<div style="text-align:center;padding:40px 20px;background:#f8fafc;border-radius:16px;"><h4 style="font-weight:700;font-size:18px;font-family:'Playfair Display',serif;">Veri Yükleniyor...</h4><p style="color:#475569;margin-top:4px">Parfüm koleksiyonu hazırlanıyor, lütfen bekleyin.</p></div>`;
        },

        showInitialState() {
            DOM.resultsOutput.innerHTML = `<div style="text-align:center;padding:40px 20px;background:var(--shell-bg);border-radius:16px"><h4 style="font-weight:700;font-size:18px;font-family:'Playfair Display',serif">Koleksiyon Yüklendi</h4><p style="color:var(--text-muted);margin-top:4px">Bir parfüm arayabilir veya "Beni Şaşırt!" butonunu kullanabilirsiniz.</p></div>`;
            showToast(`✅ ${state.perfumes.length} parfüm başarıyla yüklendi.`, 'ok');
        },

        showErrorState() {
             DOM.resultsOutput.innerHTML = `<div style="text-align:center;padding:40px 20px;background:var(--shell-bg);border-radius:16px"><h4 style="font-weight:700;font-size:18px;font-family:'Playfair Display',serif">Yükleme Başarısız</h4><p style="color:var(--text-muted);margin-top:4px">'${DATA_URL}' dosyası bulunamadı veya hatalı.</p></div>`;
        },

        setRandomHeroPerfume(perfume = null) {
            if (!perfume && state.perfumes.length > 0) {
                 perfume = state.perfumes[Math.floor(Math.random() * state.perfumes.length)];
            }
            if (!perfume) return;
            
            const imageUrl = perfume['Image URL'] || `https://placehold.co/930x930/e2e8f0/64748b?text=${encodeURIComponent(perfume.Brand?.[0] || '?')}`;
            DOM.heroShot.src = imageUrl;
            DOM.heroShot.alt = perfume.fullName;
            DOM.searchInput.placeholder = `örn: '${perfume.fullName || 'Aventus'}'`;
        },
        
        setReferenceAndFindSimilar(perfume, scroll = true) {
            if (!perfume) return;

            state.currentReference = perfume;
            DOM.searchInput.value = perfume.fullName;
            document.title = `${perfume.fullName} — simscent`;
            DOM.preferencesSection.style.display = 'block';

            const similar = DataService.findSimilarities(perfume);
            this.renderResults(perfume, similar);
            this.pickAndRenderFeatured();

            if (scroll) {
                $('#results').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        },

        resetToHome() {
            state.currentReference = null;
            DOM.searchInput.value = '';
            DOM.preferencesSection.style.display = 'none';
            document.title = 'simscent — Ana Sayfa';
            this.showInitialState();
            this.setRandomHeroPerfume();
            this.pickAndRenderFeatured();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        },
        
        // --- HTML Template Functions ---
        
        renderSuggestions(results) {
            if (results.length === 0) {
                DOM.suggestions.style.display = 'none';
                return;
            }
            const html = results.map(({ item, refIndex }) => {
                const thumb = item['Image URL'] || `https://placehold.co/40x40/e2e8f0/64748b?text=${encodeURIComponent(item.Brand?.[0] || '?')}`;
                const brandAndYear = [item.Brand, item['Release Year']].filter(Boolean).join(', ');
                return `
                    <div class='suggestion-item' data-index='${refIndex}'>
                        <img class='suggestion-item__thumb' src='${thumb}' alt='' loading='lazy'/>
                        <div class='suggestion-item__name'>${item.fullName}</div>
                        <div class='suggestion-item__brand'>${brandAndYear}</div>
                    </div>
                `;
            }).join('');
            DOM.suggestions.innerHTML = html;
            DOM.suggestions.style.display = 'block';
        },

        renderResults(ref, similar) {
            DOM.resultsOutput.innerHTML = ''; // Clear previous results
            DOM.resultsOutput.appendChild(this.createRefDetailCard(ref));

            if (similar.length > 0) {
                const similarSection = document.createElement('div');
                similarSection.innerHTML = `
                    <h3 class="section-title" style="margin-top:40px;">Benzer Parfümler</h3>
                    <div class="carousel-container">
                        <div class="carousel__window">
                            ${similar.map(s => this.createPerfumeCard(s.perfume, s.similarity)).join('')}
                        </div>
                        <button class="carousel__btn carousel__btn--prev" aria-label="Önceki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg></button>
                        <button class="carousel__btn carousel__btn--next" aria-label="Sonraki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg></button>
                    </div>`;
                DOM.resultsOutput.appendChild(similarSection);
                this.setupCarousel(similarSection.querySelector('.carousel-container'));
            }
        },
        
        createPerfumeCard(perfume, similarity) {
            const simText = typeof similarity === 'number' ? `${Math.round(similarity * 100)}% Benzer` : 'Öneri';
            const img = perfume['Image URL'] || `https://placehold.co/240x240/e2e8f0/64748b?text=${encodeURIComponent(perfume.Brand?.[0] || '?')}`;
            
            const cardHtml = `
                <div class="perfume-card" style="cursor: pointer;">
                    <img class='perfume-card__img' src='${img}' alt='${perfume.fullName}'/>
                    <div>
                        <div style='display:flex;align-items:flex-start;gap:8px'>
                            <div class='perfume-card__brand data-link' data-type="brand" data-value="${perfume.Brand}">${perfume.Brand}</div>
                            <div class='badge'>${simText}</div>
                        </div>
                        <div class='perfume-card__name' style="margin-top:4px">${perfume.fullName}</div>
                    </div>
                </div>
            `;

            // Creating element from string to attach event listener
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = cardHtml.trim();
            const cardEl = tempDiv.firstChild;
            cardEl.addEventListener('click', () => this.setReferenceAndFindSimilar(perfume));
            
            // This is a simplified way. We need to convert it back to string for the map.
            return cardEl.outerHTML;
        },

        createRefDetailCard(p) {
            const toPct = (v) => Math.round(Math.max(0, Math.min(10, Number(v))) * 10);
            const scoreHTML = (value, label) => {
                const v = toPct(value);
                const R = 24, C = 2 * Math.PI * R, offset = C - (v / 100) * C;
                return `<div class='score-item'>
                            <div class='score-item__ring'>
                                <svg class='score-item__svg' viewBox='0 0 54 54'>
                                    <circle class='score-item__bg' cx='27' cy='27' r='${R}'></circle>
                                    <circle class='score-item__fg' cx='27' cy='27' r='${R}' stroke-dasharray='${C}' stroke-dashoffset='${offset}'></circle>
                                </svg>
                                <div class='score-item__val'>${v}</div>
                            </div>
                            <div>${label}</div>
                        </div>`;
            };

            const img = p['Image URL'] || `https://placehold.co/480x480/e2e8f0/64748b?text=${encodeURIComponent(p.Brand?.[0] || '?')}`;
            const accords = (p['Main Accords'] || '')
                .split(',')
                .map(s => s.trim())
                .filter(Boolean)
                .map(a => `<span class='chip data-link accord-link' data-type='accord' data-value='${a}'>${CONSTANTS.ACCORD_TR[a.toLowerCase()] || a}</span>`)
                .join('');
            
            const el = document.createElement('div');
            el.className = 'card';
            el.innerHTML = `
                <div class="card__inner">
                    <div class="ref-card__grid">
                        <img class='ref-card__image' src='${img}' alt='${p.fullName}'/>
                        <div>
                            <div class='perfume-card__brand data-link' data-type="brand" data-value="${p.Brand}">${p.Brand || '—'}</div>
                            <h2 class='ref-card__title'>${p.fullName}</h2>
                            <p class='ref-card__sub'>${p['Release Year'] || ''}</p>
                            <div class="detail-section">
                                <h4 class='detail-section__title'>Ana Akordlar</h4>
                                <div class='chips'>${accords || '<span class="chip" style="opacity:.7">Belirtilmedi</span>'}</div>
                            </div>
                            <div class="detail-section">
                                <h4 class='detail-section__title'>Puanlar</h4>
                                <div class='scores'>
                                    ${scoreHTML(p.Longevity, 'Kalıcılık')}
                                    ${scoreHTML(p.Scent, 'Koku')}
                                    ${scoreHTML(p.Sillage, 'Yayılım')}
                                    ${scoreHTML(p['Value for Money'], 'Değer')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            return el;
        },

        setupCarousel(container) {
            const windowEl = container.querySelector('.carousel__window');
            const prevBtn = container.querySelector('.carousel__btn--prev');
            const nextBtn = container.querySelector('.carousel__btn--next');
            if (!windowEl || !prevBtn || !nextBtn || windowEl.children.length === 0) return;

            const updateButtons = () => {
                const atStart = windowEl.scrollLeft < 10;
                const atEnd = Math.abs(windowEl.scrollWidth - windowEl.clientWidth - windowEl.scrollLeft) < 10;
                prevBtn.disabled = atStart;
                nextBtn.disabled = atEnd;
            };

            const scroll = (direction) => {
                const cardWidth = windowEl.querySelector('.perfume-card').offsetWidth;
                const scrollAmount = (cardWidth + 24) * direction; // 24px is margin-right
                windowEl.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            };
            
            prevBtn.addEventListener('click', () => scroll(-1));
            nextBtn.addEventListener('click', () => scroll(1));
            windowEl.addEventListener('scroll', updateButtons, { passive: true });

            // Hide buttons if not scrollable
            const checkVisibility = () => {
                const isScrollable = windowEl.scrollWidth > windowEl.clientWidth;
                prevBtn.style.display = nextBtn.style.display = isScrollable ? 'flex' : 'none';
                updateButtons();
            };

            // Use ResizeObserver to handle layout changes
            new ResizeObserver(checkVisibility).observe(windowEl);
            checkVisibility();
        }
    };

    // --- INITIALIZE THE APP ---
    App.init();
});
</script>
</body>
</html>

